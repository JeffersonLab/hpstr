<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>hpstr: analysis/src/BlFitHistos.cxx Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">hpstr
   </div>
   <div id="projectbrief">The Heavy Photon Search Toolkit for Reconstruction (hpstr) provides an interface to physics data from the HPS experiment saved in the LCIO format and converts it into an ROOT based format.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_b8678fa8510b7ff9a55ffd4d18fd5e47.html">analysis</a></li><li class="navelem"><a class="el" href="dir_bc66cf0f7bc2a011134b03d878d297c1.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">BlFitHistos.cxx</div>  </div>
</div><!--header-->
<div class="contents">
<a href="BlFitHistos_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BlFitHistos_8h.html">BlFitHistos.h</a>&quot;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160; </div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//Globally used fit window</span></div>
<div class="line"><a name="l00005"></a><span class="lineno"><a class="line" href="BlFitHistos_8cxx.html#a898e81aa9b4e6b6beb2b5d1bba902c26">    5</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="BlFitHistos_8cxx.html#a898e81aa9b4e6b6beb2b5d1bba902c26">fitmin</a>;</div>
<div class="line"><a name="l00006"></a><span class="lineno"><a class="line" href="BlFitHistos_8cxx.html#ae0d4c19488efa3fa34f566ca38fc38b8">    6</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="BlFitHistos_8cxx.html#ae0d4c19488efa3fa34f566ca38fc38b8">fitmax</a>;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160; </div>
<div class="line"><a name="l00008"></a><span class="lineno"><a class="line" href="classBlFitHistos.html#a99006696c3abb62d30f172cc9bcfe005">    8</a></span>&#160;<a class="code" href="classBlFitHistos.html#a99006696c3abb62d30f172cc9bcfe005">BlFitHistos::BlFitHistos</a>(<span class="keywordtype">int</span> year) {</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    <span class="comment">//ModuleMapper used to translate between hw and sw names</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    <a class="code" href="classBlFitHistos.html#ae08c8c0a30c96131bc7d0cf9612877b9">mmapper_</a> = <span class="keyword">new</span> <a class="code" href="classModuleMapper.html">ModuleMapper</a>(year);</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160; </div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    <span class="comment">//Global svtIDMap built in ModuleMapper. Required to output baselines in database format</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    <a class="code" href="classBlFitHistos.html#ac9490d23374f8c635740fd9126308d6f">svtIDMap</a> = <a class="code" href="classBlFitHistos.html#ae08c8c0a30c96131bc7d0cf9612877b9">mmapper_</a>-&gt;<a class="code" href="classModuleMapper.html#ac38816992997c272b3ea6fd19915063d">buildChannelSvtIDMap</a>();</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;}</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160; </div>
<div class="line"><a name="l00016"></a><span class="lineno"><a class="line" href="classBlFitHistos.html#a8cd1f2f3cbd482abe13d6b1742138a77">   16</a></span>&#160;<a class="code" href="classBlFitHistos.html#a8cd1f2f3cbd482abe13d6b1742138a77">BlFitHistos::~BlFitHistos</a>() {</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;}</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160; </div>
<div class="line"><a name="l00019"></a><span class="lineno"><a class="line" href="classBlFitHistos.html#a52d940937dee537e69c27ebbc7f12d5d">   19</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classBlFitHistos.html#a52d940937dee537e69c27ebbc7f12d5d">BlFitHistos::getHistosFromFile</a>(TFile* inFile, std::string <a class="code" href="namespaceconfig_1_1fitBL__cfg.html#a95f2e9e3b2b2d837f962bcfb58a2011e">layer</a>){</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160; </div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> hist: <a class="code" href="classHistoManager.html#ab20a1d19398c0c0c5bbeb8f26294cbf6">_h_configs</a>.items()) {</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;        std::string h_name = hist.key();</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;h_name: &quot;</span> &lt;&lt; h_name &lt;&lt; std::endl;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160; </div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        <span class="comment">//Check for substring &quot;L&lt;layer&gt;&quot; in input histograms</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        std::size_t found = (h_name).find_first_of(<span class="stringliteral">&quot;_&quot;</span>);</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;        std::string h_layer = h_name.substr(0,found);</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;        <span class="keywordflow">if</span> (h_layer.find(<a class="code" href="namespaceconfig_1_1fitBL__cfg.html#a95f2e9e3b2b2d837f962bcfb58a2011e">layer</a>) == std::string::npos)</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="classBlFitHistos.html#afa3f4fa08a8a3b675e2dab06e29412a1">debug_</a>)</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;found layer &quot;</span> &lt;&lt; <a class="code" href="namespaceconfig_1_1fitBL__cfg.html#a95f2e9e3b2b2d837f962bcfb58a2011e">layer</a> &lt;&lt; <span class="stringliteral">&quot; in &quot;</span> &lt;&lt; h_name &lt;&lt; std::endl;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        found = (h_name).find_last_of(<span class="stringliteral">&quot;_&quot;</span>);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        std::string sample = h_name.substr(found+1);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="classBlFitHistos.html#afa3f4fa08a8a3b675e2dab06e29412a1">debug_</a>)</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;time sample is &quot;</span> &lt;&lt; sample &lt;&lt; std::endl;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        TIter next(inFile-&gt;GetListOfKeys());</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        TKey *key;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        <span class="keywordtype">bool</span> got = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        std::string histoname;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        <span class="keywordflow">while</span> ((key = (TKey*)next())) {</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;            std::string name(key-&gt;GetName());</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="classBlFitHistos.html#afa3f4fa08a8a3b675e2dab06e29412a1">debug_</a>)</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                std::cout &lt;&lt; <span class="stringliteral">&quot;Checking if histokey &quot;</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot; matches &quot;</span> &lt;&lt; h_name &lt;&lt; std::endl;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;            <span class="keywordflow">if</span> (name.find(h_name) != std::string::npos){</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                TH2F *hh = (TH2F*) inFile-&gt; Get(key-&gt;GetName());</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                <a class="code" href="classBlFitHistos.html#a10335fa6c3b50bcc19eb80359bfb4d24">histos2d</a>[key-&gt;GetName()] = hh;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                std::cout &lt;&lt; <span class="stringliteral">&quot;Adding histo &quot;</span> &lt;&lt; key-&gt;GetName() &lt;&lt; <span class="stringliteral">&quot; to list of histos to fit&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;            }</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        }</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    }</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;}</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="classBlFitHistos.html#afec18a88d97381a0744f4777874073f4">   55</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classBlFitHistos.html#afec18a88d97381a0744f4777874073f4">BlFitHistos::backwardsIterChi2Fit</a>(TH1D* hist, <span class="keywordtype">double</span> xmin, <span class="keywordtype">double</span> xmax){</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    TF1 *fit = <span class="keyword">new</span> TF1(<span class="stringliteral">&quot;fit&quot;</span>, <span class="stringliteral">&quot;gaus&quot;</span>, xmin, xmax);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    hist-&gt;Fit(<span class="stringliteral">&quot;fit&quot;</span>,<span class="stringliteral">&quot;ORQN&quot;</span>,<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordtype">double</span> fitMean = fit-&gt;GetParameter(1);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordtype">double</span> fitSig = fit-&gt;GetParameter(2);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keywordtype">double</span> fitnorm = fit-&gt;GetParameter(0);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordtype">double</span> fitchi2 = fit-&gt;GetChisquare();</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordtype">double</span> fitndf = fit-&gt;GetNDF();</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160; </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordtype">double</span> iterChi2 = fitchi2/fitndf;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keywordtype">double</span> newChi2 = 0;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordtype">double</span> stepx = hist-&gt;GetBinWidth(0);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordtype">double</span> iterxmax = xmax;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordtype">int</span> i = 0;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classBlFitHistos.html#afa3f4fa08a8a3b675e2dab06e29412a1">debug_</a>){</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;Initial xmin and xmax &quot;</span> &lt;&lt; xmin &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; xmax &lt;&lt; std::endl;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;Initial mean and sigma &quot;</span> &lt;&lt; fitMean &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; fitSig &lt;&lt; std::endl;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;Initial Chi2: &quot;</span> &lt;&lt; iterChi2 &lt;&lt; std::endl;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    }</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordflow">while</span>((iterxmax &gt; xmin + 10*stepx) &amp;&amp; (newChi2 &lt; iterChi2*0.98)){</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        xmax = iterxmax;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        iterxmax = iterxmax - stepx;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="classBlFitHistos.html#afa3f4fa08a8a3b675e2dab06e29412a1">debug_</a>)</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;Iterating xmax to: &quot;</span> &lt;&lt; iterxmax &lt;&lt; std::endl;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keywordflow">if</span>(i &gt; 0){</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            iterChi2 = newChi2;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        }</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160; </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        fit-&gt;SetRange(xmin,iterxmax);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        hist-&gt;Fit(<span class="stringliteral">&quot;fit&quot;</span>,<span class="stringliteral">&quot;ORQN&quot;</span>,<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        fitMean = fit-&gt;GetParameter(1);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        fitSig = fit-&gt;GetParameter(2);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        fitnorm = fit-&gt;GetParameter(0);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        fitchi2 = fit-&gt;GetChisquare();</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        fitndf = fit-&gt;GetNDF();</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160; </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <span class="keywordflow">if</span>(fitMean &gt; iterxmax){</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        }</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="keywordflow">if</span>(fitndf &gt; 0){</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            newChi2 = fitchi2/fitndf;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="classBlFitHistos.html#afa3f4fa08a8a3b675e2dab06e29412a1">debug_</a>){</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                std::cout &lt;&lt; <span class="stringliteral">&quot;iter&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; newChi2 = &quot;</span> &lt;&lt; newChi2 &lt;&lt; std::endl;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            }</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        }</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        }</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        i++;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    }</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160; </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <a class="code" href="BlFitHistos_8cxx.html#ae0d4c19488efa3fa34f566ca38fc38b8">fitmax</a> = xmax;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;}</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160; </div>
<div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="classBlFitHistos.html#aff51a7f616d42f826718be921aed21a8">  115</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classBlFitHistos.html#aff51a7f616d42f826718be921aed21a8">BlFitHistos::iterativeGausFit</a>(TH1D* hist, <span class="keywordtype">double</span> min, <span class="keywordtype">double</span> max, <span class="keywordtype">double</span> sigmaRange, <span class="keywordtype">double</span> hardminimum, <span class="keywordtype">double</span> hardmaximum) {</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordtype">double</span> minthresh = hardminimum;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordtype">double</span> threshold = hardmaximum;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="comment">//perform single Gaus fit across full range of histo</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keywordflow">if</span> (min &lt; 0.0 )</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        min = hist-&gt;GetBinLowEdge(hist-&gt;FindFirstBinAbove(0.0,1));</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160; </div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordflow">if</span> (max &lt; 0.0 )</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        max = hist-&gt;GetBinLowEdge(hist-&gt;FindLastBinAbove(0.0,1));</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="comment">//Initial fit to establish rough mean and sigma</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classBlFitHistos.html#afa3f4fa08a8a3b675e2dab06e29412a1">debug_</a>)</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;initial min: &quot;</span> &lt;&lt; min &lt;&lt; <span class="stringliteral">&quot; | initial max: &quot;</span> &lt;&lt; max &lt;&lt; std::endl;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160; </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    TF1 *fitA = <span class="keyword">new</span> TF1(<span class="stringliteral">&quot;fitA&quot;</span>, <span class="stringliteral">&quot;gaus&quot;</span>, min, max);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    hist-&gt;Fit(<span class="stringliteral">&quot;fitA&quot;</span>,<span class="stringliteral">&quot;ORQN&quot;</span>,<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordtype">double</span> fitAMean = fitA-&gt;GetParameter(1);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordtype">double</span> fitASig = fitA-&gt;GetParameter(2);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160; </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keyword">delete</span> fitA;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160; </div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">if</span>(fitAMean + fitASig*sigmaRange &lt; threshold)</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        max = fitAMean + fitASig*sigmaRange;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keywordflow">if</span>(fitAMean - fitASig*sigmaRange &gt; minthresh)</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        min = fitAMean - fitASig*sigmaRange;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160; </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classBlFitHistos.html#afa3f4fa08a8a3b675e2dab06e29412a1">debug_</a>){</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;meanA &quot;</span> &lt;&lt; fitAMean &lt;&lt; <span class="stringliteral">&quot; | sigmaA: &quot;</span> &lt;&lt; fitASig &lt;&lt; std::endl;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;minA: &quot;</span> &lt;&lt; min &lt;&lt; <span class="stringliteral">&quot; | maxA: &quot;</span> &lt;&lt; max &lt;&lt; std::endl;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    }</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="comment">//Fit second time using updated min and max</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    TF1 *fitB = <span class="keyword">new</span> TF1(<span class="stringliteral">&quot;fitB&quot;</span>, <span class="stringliteral">&quot;gaus&quot;</span>, min, max);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    hist-&gt;Fit(<span class="stringliteral">&quot;fitB&quot;</span>,<span class="stringliteral">&quot;ORQN&quot;</span>,<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keywordtype">double</span> fitMean = fitB-&gt;GetParameter(1);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordtype">double</span> fitSig = fitB-&gt;GetParameter(2);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classBlFitHistos.html#afa3f4fa08a8a3b675e2dab06e29412a1">debug_</a>)</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;meanB &quot;</span> &lt;&lt; fitMean &lt;&lt; <span class="stringliteral">&quot; | sigmaB: &quot;</span> &lt;&lt; fitSig &lt;&lt; std::endl;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160; </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">if</span>(fitMean + fitSig*sigmaRange &lt; threshold)</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        max = fitMean + fitSig*sigmaRange;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordflow">if</span>(fitMean - fitSig*sigmaRange &gt; minthresh)</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        min = fitMean - fitSig*sigmaRange;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classBlFitHistos.html#afa3f4fa08a8a3b675e2dab06e29412a1">debug_</a>)</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;minB: &quot;</span> &lt;&lt; min &lt;&lt; <span class="stringliteral">&quot; | maxB: &quot;</span> &lt;&lt; max &lt;&lt; std::endl;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160; </div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    TF1 *fit = <span class="keyword">new</span> TF1(<span class="stringliteral">&quot;fit&quot;</span>, <span class="stringliteral">&quot;gaus&quot;</span>, min, max);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    hist-&gt;Fit(<span class="stringliteral">&quot;fit&quot;</span>,<span class="stringliteral">&quot;ORQN&quot;</span>,<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordtype">double</span> newFitSig = 99999;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordtype">double</span> newFitMean = 99999;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordtype">int</span> i = 0;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordflow">while</span> (std::abs(fitSig - newFitSig) &gt; 0.0005 || std::abs(fitMean - newFitMean) &gt; 0.0005) {</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="keywordtype">double</span> itermax = max;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="keywordtype">double</span> itermin = min;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="keywordflow">if</span>(i &gt; 0){</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            fitMean = newFitMean;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            fitSig = newFitSig;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        }</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160; </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="keywordflow">if</span>(fitMean + fitSig*sigmaRange &lt; threshold)</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            max = fitMean + fitSig*sigmaRange;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="keywordflow">if</span>(fitMean - fitSig*sigmaRange &gt; minthresh)</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            min = fitMean - fitSig*sigmaRange;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        fit-&gt;SetRange(min,max);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        hist-&gt;Fit(<span class="stringliteral">&quot;fit&quot;</span>,<span class="stringliteral">&quot;ORQN&quot;</span>,<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160; </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        newFitMean = fit-&gt;GetParameter(1);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        newFitSig = fit-&gt;GetParameter(2);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160; </div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordflow">if</span>(i &gt; 20)</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        i = i + 1;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    }</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <a class="code" href="BlFitHistos_8cxx.html#a898e81aa9b4e6b6beb2b5d1bba902c26">fitmin</a> = min;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <a class="code" href="BlFitHistos_8cxx.html#ae0d4c19488efa3fa34f566ca38fc38b8">fitmax</a> = max;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;}</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160; </div>
<div class="line"><a name="l00197"></a><span class="lineno"><a class="line" href="classBlFitHistos.html#ae3119cb41a25240573c5a200b75a4a43">  197</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classBlFitHistos.html#ae3119cb41a25240573c5a200b75a4a43">BlFitHistos::fit2DHistoChannelBaselines</a>(std::map&lt;std::string,TH2F*&gt; histos2d, <span class="keywordtype">int</span> rebin_, <span class="keywordtype">int</span> minStats_, <span class="keywordtype">int</span> deadRMS_, std::string thresholdsFileIn_, <a class="code" href="classFlatTupleMaker.html">FlatTupleMaker</a>* flat_tuple_) {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160; </div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="comment">//Get half module string names </span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    std::vector&lt;std::string&gt; halfmodule_strings;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <a class="code" href="classBlFitHistos.html#ae08c8c0a30c96131bc7d0cf9612877b9">mmapper_</a>-&gt;<a class="code" href="classModuleMapper.html#a6c18b3d8eaf215d60f1f9350ec29d3fb">getStrings</a>(halfmodule_strings);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160; </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">//Build FebHybAPV thresholds map in modulemapper</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <a class="code" href="classBlFitHistos.html#ae08c8c0a30c96131bc7d0cf9612877b9">mmapper_</a>-&gt;<a class="code" href="classModuleMapper.html#afda3474d4449108d05d301a5cc0ca08c">buildApvChannelMap</a>();</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="comment">//Read apv channel thresholds from file for closest run</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <a class="code" href="classBlFitHistos.html#ae08c8c0a30c96131bc7d0cf9612877b9">mmapper_</a>-&gt;<a class="code" href="classModuleMapper.html#a871d358f1e60589961e8b3eab7c5d53d">ReadThresholdsFile</a>(thresholdsFileIn_);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="comment">//Loop over rawsvthit 2D histograms, one for each selected halfmodule</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">for</span>(std::map&lt;std::string, TH2F*&gt;::iterator it = <a class="code" href="classBlFitHistos.html#a10335fa6c3b50bcc19eb80359bfb4d24">histos2d</a>.begin(); it != <a class="code" href="classBlFitHistos.html#a10335fa6c3b50bcc19eb80359bfb4d24">histos2d</a>.end(); ++it)</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    {</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        gDirectory-&gt;cd(<span class="stringliteral">&quot;/&quot;</span>);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        TH2F* halfmodule_hh = it-&gt;second; </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        halfmodule_hh-&gt;RebinY(rebin_);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        halfmodule_hh-&gt;Write();</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        std::string hh_name = it-&gt;first;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160; </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="comment">//get the hardware tag for this F&lt;n&gt;H&lt;M&gt;. Required for svtid mapping</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        std::string hwTag;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="keywordflow">for</span>(std::vector&lt;std::string&gt;::iterator it = halfmodule_strings.begin(); it != halfmodule_strings.end(); ++it){</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            <span class="keywordflow">if</span>(hh_name.find(*it) != std::string::npos){</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                hwTag = <a class="code" href="classBlFitHistos.html#ae08c8c0a30c96131bc7d0cf9612877b9">mmapper_</a>-&gt;<a class="code" href="classModuleMapper.html#a79c07460964e9054304aecf6ae358026">getHwFromString</a>(*it);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="classBlFitHistos.html#afa3f4fa08a8a3b675e2dab06e29412a1">debug_</a>)</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                    std::cout &lt;&lt; <span class="stringliteral">&quot;hwTag for &quot;</span> &lt;&lt; hh_name &lt;&lt; <span class="stringliteral">&quot; is &quot;</span> &lt;&lt; hwTag &lt;&lt; std::endl;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            }</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        }</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160; </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="comment">//Feb and Hybrid numbers</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        std::string feb = (hwTag.substr(1,1));</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        std::string hyb = (hwTag.substr(3,1));</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        gDirectory-&gt;mkdir((<span class="stringliteral">&quot;F&quot;</span>+feb+<span class="stringliteral">&quot;H&quot;</span>+hyb).c_str())-&gt;cd();</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="comment">//Perform fitting procedure over all channels on a sensor</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> cc=0; cc &lt; 640 ; ++cc) </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="classBlFitHistos.html#afa3f4fa08a8a3b675e2dab06e29412a1">debug_</a>){</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                std::cout &lt;&lt; hh_name &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; cc &lt;&lt; std::endl;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                std::cout &lt;&lt; <span class="stringliteral">&quot;CHANNEL &quot;</span> &lt;&lt; cc &lt;&lt; std::endl;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            }</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            <span class="keywordflow">if</span> (cc%100 == 0)</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                std::cout &lt;&lt; <span class="stringliteral">&quot;CHANNEL &quot;</span> &lt;&lt; cc &lt;&lt; std::endl;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160; </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            <span class="comment">//get the global svt_id for channel</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            <span class="keywordtype">int</span> svt_id = <a class="code" href="classBlFitHistos.html#ae08c8c0a30c96131bc7d0cf9612877b9">mmapper_</a>-&gt;<a class="code" href="classModuleMapper.html#ad68f12490dedfab67580d5039c1c96b2">getSvtIDFromHWChannel</a>(cc, hwTag, <a class="code" href="classBlFitHistos.html#ac9490d23374f8c635740fd9126308d6f">svtIDMap</a>);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="classBlFitHistos.html#afa3f4fa08a8a3b675e2dab06e29412a1">debug_</a>)</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                std::cout &lt;&lt; <span class="stringliteral">&quot;Global SVT ID: &quot;</span> &lt;&lt; svt_id &lt;&lt; std::endl;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160; </div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            <span class="comment">//Feb 0-1 have max_channel = 512.</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            <span class="comment">//svt_id = 99999 means max_channel reached. Skip cc &gt; 512 </span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            <span class="keywordflow">if</span>(svt_id == 99999)  </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            <span class="comment">//load apv channel readout threshold value from run_thresholds.dat file</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            <span class="keywordtype">double</span> threshold = (double) <a class="code" href="classBlFitHistos.html#ae08c8c0a30c96131bc7d0cf9612877b9">mmapper_</a>-&gt;<a class="code" href="classModuleMapper.html#a9c88be37266a1d5573dac27e47b8ece7">getThresholdValue</a>(feb, hyb, cc); </div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="classBlFitHistos.html#afa3f4fa08a8a3b675e2dab06e29412a1">debug_</a>)</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                std::cout &lt;&lt; <span class="stringliteral">&quot;THRESHOLD F&quot;</span> &lt;&lt;feb &lt;&lt; <span class="stringliteral">&quot;H&quot;</span> &lt;&lt;hyb &lt;&lt; <span class="stringliteral">&quot;channel &quot;</span> &lt;&lt; cc &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; threshold &lt;&lt; std::endl;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160; </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            <span class="comment">//Set Channel and Hybrid information and paramaters in the flat tuple</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;halfmodule_hh&quot;</span>, hh_name);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;channel&quot;</span>, cc);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;svt_id&quot;</span>, svt_id);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;            flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;minStats&quot;</span>, (<span class="keywordtype">double</span>)minStats_);</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;rebin&quot;</span>, (<span class="keywordtype">double</span>)rebin_);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160; </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            <span class="comment">//Get YProjection (1D Channel Histo) from 2D Histogram </span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            TH1D* projy_h = halfmodule_hh-&gt;ProjectionY(Form(<span class="stringliteral">&quot;%s_proY_ch%i&quot;</span>,hh_name.c_str(),cc),</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                    cc+1,cc+1,<span class="stringliteral">&quot;e&quot;</span>);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            projy_h-&gt;Smooth(1);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            projy_h-&gt;SetTitle(Form(<span class="stringliteral">&quot;%s_proY_ch%i&quot;</span>,hh_name.c_str(),cc));</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160; </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            <span class="comment">//Check number of entries and RMS of channel</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;n_entries&quot;</span>, projy_h-&gt;GetEntries());</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            <span class="keywordtype">double</span> chRMS = projy_h-&gt;GetRMS();</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;rms&quot;</span>, chRMS);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160; </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            <span class="comment">//If the channel RMS is under some threshold, flag it as &quot;dead&quot;</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            <span class="keywordflow">if</span>(chRMS &lt; deadRMS_ || projy_h-&gt;GetEntries() == 0)</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;dead&quot;</span>,1.0);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160; </div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            <span class="comment">//Fit window max set by threshold value loaded from file</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            <span class="comment">//Minum value of x set to first bin with fraction of maximum value</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            <span class="keywordtype">double</span> maxbin = projy_h-&gt;GetBinContent(projy_h-&gt;GetMaximumBin());</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            <span class="comment">//double frac = 0.15;</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            <span class="keywordtype">double</span> frac = 0.2;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            <span class="keywordtype">int</span> minbin = projy_h-&gt;FindFirstBinAbove((<span class="keywordtype">double</span>)frac*maxbin,1);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            <span class="keywordtype">double</span> minx = projy_h-&gt;GetBinLowEdge(minbin);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;minthreshold&quot;</span>,minx);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;            <span class="keywordtype">double</span> binwidth = projy_h-&gt;GetBinWidth(minbin);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            <span class="keywordtype">double</span> minxVal = projy_h-&gt;GetBinContent(minbin);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            <span class="keywordtype">double</span> maxx = threshold - binwidth*1;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;threshold&quot;</span>,maxx);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160; </div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            <span class="comment">//If channel does not have the minimum statistics required, set all variables to -9999.9</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            <span class="comment">//and skip the fit procedure on this channel</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            <span class="keywordflow">if</span> (minbin == -1 || projy_h-&gt;GetEntries() &lt; minStats_ ) </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            {</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;BlFitMean&quot;</span>, -9999.9);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;BlFitSigma&quot;</span>, -9999.9);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;BlFitNorm&quot;</span>, -9999.9);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;BlFitRangeLower&quot;</span>, -9999.9);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;BlFitRangeUpper&quot;</span>, -9999.9);</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;BlFitChi2&quot;</span>, -9999.9);</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;BlFitNdf&quot;</span>, -9999.9);</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;lowdaq&quot;</span>, 0.0);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;suplowDaq&quot;</span>, 0.0);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;lowStats&quot;</span>,1.0);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;badfit&quot;</span>,0.0);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#aed2e8e8986e7d641f74b6dc70f26cb0e">fill</a>();</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            }</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;lowStats&quot;</span>,0.0);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            <a class="code" href="BlFitHistos_8cxx.html#a898e81aa9b4e6b6beb2b5d1bba902c26">fitmin</a> = minx;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            <a class="code" href="BlFitHistos_8cxx.html#ae0d4c19488efa3fa34f566ca38fc38b8">fitmax</a> = maxx;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            <a class="code" href="classBlFitHistos.html#aff51a7f616d42f826718be921aed21a8">iterativeGausFit</a>(projy_h, <a class="code" href="BlFitHistos_8cxx.html#a898e81aa9b4e6b6beb2b5d1bba902c26">fitmin</a>, <a class="code" href="BlFitHistos_8cxx.html#ae0d4c19488efa3fa34f566ca38fc38b8">fitmax</a>, 1, minx, threshold);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            <a class="code" href="classBlFitHistos.html#afec18a88d97381a0744f4777874073f4">backwardsIterChi2Fit</a>(projy_h, <a class="code" href="BlFitHistos_8cxx.html#a898e81aa9b4e6b6beb2b5d1bba902c26">fitmin</a>, <a class="code" href="BlFitHistos_8cxx.html#ae0d4c19488efa3fa34f566ca38fc38b8">fitmax</a>);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160; </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            TF1 *fit = <span class="keyword">new</span> TF1(<span class="stringliteral">&quot;fit&quot;</span>, <span class="stringliteral">&quot;gaus&quot;</span>, <a class="code" href="BlFitHistos_8cxx.html#a898e81aa9b4e6b6beb2b5d1bba902c26">fitmin</a>, <a class="code" href="BlFitHistos_8cxx.html#ae0d4c19488efa3fa34f566ca38fc38b8">fitmax</a>);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            projy_h-&gt;Fit(<span class="stringliteral">&quot;fit&quot;</span>,<span class="stringliteral">&quot;ORQ&quot;</span>,<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            <span class="keywordtype">double</span> fitmean = fit-&gt;GetParameter(1);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            <span class="keywordtype">double</span> fitsigma = fit-&gt;GetParameter(2);</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            <span class="keywordtype">double</span> fitnorm = fit-&gt;GetParameter(0);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            <span class="keywordtype">double</span> fitchi2 = fit-&gt;GetChisquare();</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            <span class="keywordtype">double</span> fitndf = fit-&gt;GetNDF();</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160; </div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="classBlFitHistos.html#afa3f4fa08a8a3b675e2dab06e29412a1">debug_</a>){</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                std::cout &lt;&lt; <span class="stringliteral">&quot;Fit Mean: &quot;</span> &lt;&lt; fitmean &lt;&lt; std::endl;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                std::cout &lt;&lt; <span class="stringliteral">&quot;Fit sigma: &quot;</span> &lt;&lt; fitsigma &lt;&lt; std::endl;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                std::cout &lt;&lt; <span class="stringliteral">&quot;Fit norm: &quot;</span> &lt;&lt; fitnorm &lt;&lt; std::endl;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                std::cout &lt;&lt; <span class="stringliteral">&quot;Fit min: &quot;</span> &lt;&lt; <a class="code" href="BlFitHistos_8cxx.html#a898e81aa9b4e6b6beb2b5d1bba902c26">fitmin</a> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                std::cout &lt;&lt; <span class="stringliteral">&quot;Fit max: &quot;</span> &lt;&lt; <a class="code" href="BlFitHistos_8cxx.html#ae0d4c19488efa3fa34f566ca38fc38b8">fitmax</a> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            }</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            projy_h-&gt;Draw();</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            projy_h-&gt;Write();</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            <span class="keyword">delete</span> fit;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            <span class="comment">//If fit mean is less than fitmax, channel does not have full gaussian shape.</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            <span class="comment">//Mark channel as super_low_Daq</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            <span class="keywordtype">bool</span> badfit = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            <span class="keywordtype">bool</span> suplowDaq = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            <span class="keywordflow">if</span>(fitmean &lt;= fitmin || fitmin &gt; <a class="code" href="BlFitHistos_8cxx.html#ae0d4c19488efa3fa34f566ca38fc38b8">fitmax</a>){</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                badfit = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="classBlFitHistos.html#afa3f4fa08a8a3b675e2dab06e29412a1">debug_</a>)</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                    std::cout &lt;&lt; <span class="stringliteral">&quot;bad fit!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            }</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160; </div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            <span class="keywordflow">if</span>(!badfit &amp;&amp; fitmean &gt;= <a class="code" href="BlFitHistos_8cxx.html#ae0d4c19488efa3fa34f566ca38fc38b8">fitmax</a>){</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                suplowDaq = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="classBlFitHistos.html#afa3f4fa08a8a3b675e2dab06e29412a1">debug_</a>)</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                    std::cout &lt;&lt; <span class="stringliteral">&quot;Super low Daq threshold&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            }</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160; </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            <span class="keywordtype">bool</span> lowdaq = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            <span class="keywordflow">if</span>(!badfit &amp;&amp; !suplowDaq){</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                <span class="comment">//Check channel to see if it has a low DAQ threshold, where landau shape interferes with baseline</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                <span class="comment">//If maxbin occurs outside of fit mean by NSigma...flag</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                <span class="keywordtype">double</span> maxbinx = projy_h-&gt;GetBinLowEdge(projy_h-&gt;GetMaximumBin());</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                <span class="keywordflow">if</span> ((std::abs(maxbinx - fitmean) &gt; fitsigma)){</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                    lowdaq = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                }</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                <span class="comment">//If fitmean &gt; fitmax or fitmean &lt; fitmin...flag</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                <span class="keywordflow">if</span>(fitmean &gt; <a class="code" href="BlFitHistos_8cxx.html#ae0d4c19488efa3fa34f566ca38fc38b8">fitmax</a> || fitmean &lt; <a class="code" href="BlFitHistos_8cxx.html#a898e81aa9b4e6b6beb2b5d1bba902c26">fitmin</a>)</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                    lowdaq = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160; </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                <span class="comment">//If bins after fitmax averaged to the right are greater than the fitmean...flag</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                <span class="keywordtype">double</span> maxavg = 0;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                <span class="keywordtype">int</span> fitmaxbin = projy_h-&gt;FindBin(<a class="code" href="BlFitHistos_8cxx.html#ae0d4c19488efa3fa34f566ca38fc38b8">fitmax</a>);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; 6; i++){</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                    maxavg = maxavg + projy_h-&gt;GetBinContent(fitmaxbin + i); </div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                }</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                maxavg = maxavg/5;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                <span class="keywordflow">if</span>(maxavg &gt; fitnorm)</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                    lowdaq = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            }</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160; </div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="classBlFitHistos.html#afa3f4fa08a8a3b675e2dab06e29412a1">debug_</a>)</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                <span class="keywordflow">if</span>(lowdaq)</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                    std::cout &lt;&lt; <span class="stringliteral">&quot;Low daq threshold&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160; </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;lowdaq&quot;</span>, lowdaq);</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;            flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;suplowDaq&quot;</span>, suplowDaq);</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;badfit&quot;</span>, badfit);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;BlFitMean&quot;</span>, fitmean);</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;BlFitSigma&quot;</span>, fitsigma);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;BlFitNorm&quot;</span>, fitnorm);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;BlFitChi2&quot;</span>, fitchi2);</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;BlFitNdf&quot;</span>, fitndf);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;BlFitRangeLower&quot;</span>, <a class="code" href="BlFitHistos_8cxx.html#a898e81aa9b4e6b6beb2b5d1bba902c26">fitmin</a>);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">setVariableValue</a>(<span class="stringliteral">&quot;BlFitRangeUpper&quot;</span>, <a class="code" href="BlFitHistos_8cxx.html#ae0d4c19488efa3fa34f566ca38fc38b8">fitmax</a>);</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160; </div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            flat_tuple_-&gt;<a class="code" href="classFlatTupleMaker.html#aed2e8e8986e7d641f74b6dc70f26cb0e">fill</a>();</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160; </div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            <span class="keyword">delete</span> projy_h;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160; </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        }</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    }</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;}</div>
<div class="ttc" id="aBlFitHistos_8cxx_html_a898e81aa9b4e6b6beb2b5d1bba902c26"><div class="ttname"><a href="BlFitHistos_8cxx.html#a898e81aa9b4e6b6beb2b5d1bba902c26">fitmin</a></div><div class="ttdeci">double fitmin</div><div class="ttdef"><b>Definition:</b> <a href="BlFitHistos_8cxx_source.html#l00005">BlFitHistos.cxx:5</a></div></div>
<div class="ttc" id="aBlFitHistos_8cxx_html_ae0d4c19488efa3fa34f566ca38fc38b8"><div class="ttname"><a href="BlFitHistos_8cxx.html#ae0d4c19488efa3fa34f566ca38fc38b8">fitmax</a></div><div class="ttdeci">double fitmax</div><div class="ttdef"><b>Definition:</b> <a href="BlFitHistos_8cxx_source.html#l00006">BlFitHistos.cxx:6</a></div></div>
<div class="ttc" id="aBlFitHistos_8h_html"><div class="ttname"><a href="BlFitHistos_8h.html">BlFitHistos.h</a></div></div>
<div class="ttc" id="aclassBlFitHistos_html_a10335fa6c3b50bcc19eb80359bfb4d24"><div class="ttname"><a href="classBlFitHistos.html#a10335fa6c3b50bcc19eb80359bfb4d24">BlFitHistos::histos2d</a></div><div class="ttdeci">std::map&lt; std::string, TH2F * &gt; histos2d</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition:</b> <a href="BlFitHistos_8h_source.html#l00107">BlFitHistos.h:107</a></div></div>
<div class="ttc" id="aclassBlFitHistos_html_a52d940937dee537e69c27ebbc7f12d5d"><div class="ttname"><a href="classBlFitHistos.html#a52d940937dee537e69c27ebbc7f12d5d">BlFitHistos::getHistosFromFile</a></div><div class="ttdeci">void getHistosFromFile(TFile *inFile, std::string layer=&quot;&quot;)</div><div class="ttdoc">Get the Histos From File object.</div><div class="ttdef"><b>Definition:</b> <a href="BlFitHistos_8cxx_source.html#l00019">BlFitHistos.cxx:19</a></div></div>
<div class="ttc" id="aclassBlFitHistos_html_a8cd1f2f3cbd482abe13d6b1742138a77"><div class="ttname"><a href="classBlFitHistos.html#a8cd1f2f3cbd482abe13d6b1742138a77">BlFitHistos::~BlFitHistos</a></div><div class="ttdeci">~BlFitHistos()</div><div class="ttdef"><b>Definition:</b> <a href="BlFitHistos_8cxx_source.html#l00016">BlFitHistos.cxx:16</a></div></div>
<div class="ttc" id="aclassBlFitHistos_html_a99006696c3abb62d30f172cc9bcfe005"><div class="ttname"><a href="classBlFitHistos.html#a99006696c3abb62d30f172cc9bcfe005">BlFitHistos::BlFitHistos</a></div><div class="ttdeci">BlFitHistos(int year)</div><div class="ttdef"><b>Definition:</b> <a href="BlFitHistos_8cxx_source.html#l00008">BlFitHistos.cxx:8</a></div></div>
<div class="ttc" id="aclassBlFitHistos_html_ac9490d23374f8c635740fd9126308d6f"><div class="ttname"><a href="classBlFitHistos.html#ac9490d23374f8c635740fd9126308d6f">BlFitHistos::svtIDMap</a></div><div class="ttdeci">std::map&lt; std::string, std::map&lt; int, int &gt; &gt; svtIDMap</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition:</b> <a href="BlFitHistos_8h_source.html#l00109">BlFitHistos.h:109</a></div></div>
<div class="ttc" id="aclassBlFitHistos_html_ae08c8c0a30c96131bc7d0cf9612877b9"><div class="ttname"><a href="classBlFitHistos.html#ae08c8c0a30c96131bc7d0cf9612877b9">BlFitHistos::mmapper_</a></div><div class="ttdeci">ModuleMapper * mmapper_</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition:</b> <a href="BlFitHistos_8h_source.html#l00111">BlFitHistos.h:111</a></div></div>
<div class="ttc" id="aclassBlFitHistos_html_ae3119cb41a25240573c5a200b75a4a43"><div class="ttname"><a href="classBlFitHistos.html#ae3119cb41a25240573c5a200b75a4a43">BlFitHistos::fit2DHistoChannelBaselines</a></div><div class="ttdeci">void fit2DHistoChannelBaselines(std::map&lt; std::string, TH2F * &gt; histos2d, int rebin_, int minStats_, int deadRMS_, std::string thresholdsFileIn_, FlatTupleMaker *flat_tuple_)</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition:</b> <a href="BlFitHistos_8cxx_source.html#l00197">BlFitHistos.cxx:197</a></div></div>
<div class="ttc" id="aclassBlFitHistos_html_afa3f4fa08a8a3b675e2dab06e29412a1"><div class="ttname"><a href="classBlFitHistos.html#afa3f4fa08a8a3b675e2dab06e29412a1">BlFitHistos::debug_</a></div><div class="ttdeci">bool debug_</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition:</b> <a href="BlFitHistos_8h_source.html#l00112">BlFitHistos.h:112</a></div></div>
<div class="ttc" id="aclassBlFitHistos_html_afec18a88d97381a0744f4777874073f4"><div class="ttname"><a href="classBlFitHistos.html#afec18a88d97381a0744f4777874073f4">BlFitHistos::backwardsIterChi2Fit</a></div><div class="ttdeci">void backwardsIterChi2Fit(TH1D *hist, double xmin, double xmax)</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition:</b> <a href="BlFitHistos_8cxx_source.html#l00055">BlFitHistos.cxx:55</a></div></div>
<div class="ttc" id="aclassBlFitHistos_html_aff51a7f616d42f826718be921aed21a8"><div class="ttname"><a href="classBlFitHistos.html#aff51a7f616d42f826718be921aed21a8">BlFitHistos::iterativeGausFit</a></div><div class="ttdeci">void iterativeGausFit(TH1D *hist, double min, double max, double sigmaRange, double hardminimum, double hardmaximum)</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition:</b> <a href="BlFitHistos_8cxx_source.html#l00115">BlFitHistos.cxx:115</a></div></div>
<div class="ttc" id="aclassFlatTupleMaker_html"><div class="ttname"><a href="classFlatTupleMaker.html">FlatTupleMaker</a></div><div class="ttdoc">description</div><div class="ttdef"><b>Definition:</b> <a href="FlatTupleMaker_8h_source.html#l00032">FlatTupleMaker.h:32</a></div></div>
<div class="ttc" id="aclassFlatTupleMaker_html_ab4ac8a5e8470f206a462bcfccde4a979"><div class="ttname"><a href="classFlatTupleMaker.html#ab4ac8a5e8470f206a462bcfccde4a979">FlatTupleMaker::setVariableValue</a></div><div class="ttdeci">void setVariableValue(std::string variable_name, double value)</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition:</b> <a href="FlatTupleMaker_8h_source.html#l00080">FlatTupleMaker.h:80</a></div></div>
<div class="ttc" id="aclassFlatTupleMaker_html_aed2e8e8986e7d641f74b6dc70f26cb0e"><div class="ttname"><a href="classFlatTupleMaker.html#aed2e8e8986e7d641f74b6dc70f26cb0e">FlatTupleMaker::fill</a></div><div class="ttdeci">void fill()</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition:</b> <a href="FlatTupleMaker_8cxx_source.html#l00081">FlatTupleMaker.cxx:81</a></div></div>
<div class="ttc" id="aclassHistoManager_html_ab20a1d19398c0c0c5bbeb8f26294cbf6"><div class="ttname"><a href="classHistoManager.html#ab20a1d19398c0c0c5bbeb8f26294cbf6">HistoManager::_h_configs</a></div><div class="ttdeci">json _h_configs</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition:</b> <a href="HistoManager_8h_source.html#l00341">HistoManager.h:341</a></div></div>
<div class="ttc" id="aclassModuleMapper_html"><div class="ttname"><a href="classModuleMapper.html">ModuleMapper</a></div><div class="ttdef"><b>Definition:</b> <a href="ModuleMapper_8h_source.html#l00011">ModuleMapper.h:11</a></div></div>
<div class="ttc" id="aclassModuleMapper_html_a6c18b3d8eaf215d60f1f9350ec29d3fb"><div class="ttname"><a href="classModuleMapper.html#a6c18b3d8eaf215d60f1f9350ec29d3fb">ModuleMapper::getStrings</a></div><div class="ttdeci">void getStrings(std::vector&lt; std::string &gt; &amp;strings)</div><div class="ttdoc">Get list of string modules.</div><div class="ttdef"><b>Definition:</b> <a href="ModuleMapper_8h_source.html#l00079">ModuleMapper.h:79</a></div></div>
<div class="ttc" id="aclassModuleMapper_html_a79c07460964e9054304aecf6ae358026"><div class="ttname"><a href="classModuleMapper.html#a79c07460964e9054304aecf6ae358026">ModuleMapper::getHwFromString</a></div><div class="ttdeci">std::string getHwFromString(const std::string &amp;key)</div><div class="ttdoc">Get the Hw From String.</div><div class="ttdef"><b>Definition:</b> <a href="ModuleMapper_8h_source.html#l00025">ModuleMapper.h:25</a></div></div>
<div class="ttc" id="aclassModuleMapper_html_a871d358f1e60589961e8b3eab7c5d53d"><div class="ttname"><a href="classModuleMapper.html#a871d358f1e60589961e8b3eab7c5d53d">ModuleMapper::ReadThresholdsFile</a></div><div class="ttdeci">void ReadThresholdsFile(std::string filename)</div><div class="ttdoc">Used to read svt channel DAQ threshold values from daq thresholds file.</div><div class="ttdef"><b>Definition:</b> <a href="ModuleMapper_8cxx_source.html#l00676">ModuleMapper.cxx:676</a></div></div>
<div class="ttc" id="aclassModuleMapper_html_a9c88be37266a1d5573dac27e47b8ece7"><div class="ttname"><a href="classModuleMapper.html#a9c88be37266a1d5573dac27e47b8ece7">ModuleMapper::getThresholdValue</a></div><div class="ttdeci">int getThresholdValue(std::string feb, std::string hybrid, int channel)</div><div class="ttdoc">Get channel DAQ threshold.</div><div class="ttdef"><b>Definition:</b> <a href="ModuleMapper_8cxx_source.html#l00749">ModuleMapper.cxx:749</a></div></div>
<div class="ttc" id="aclassModuleMapper_html_ac38816992997c272b3ea6fd19915063d"><div class="ttname"><a href="classModuleMapper.html#ac38816992997c272b3ea6fd19915063d">ModuleMapper::buildChannelSvtIDMap</a></div><div class="ttdeci">std::map&lt; std::string, std::map&lt; int, int &gt; &gt; buildChannelSvtIDMap()</div><div class="ttdoc">Build global svt id map for all FebHybrid combinations.</div><div class="ttdef"><b>Definition:</b> <a href="ModuleMapper_8cxx_source.html#l00505">ModuleMapper.cxx:505</a></div></div>
<div class="ttc" id="aclassModuleMapper_html_ad68f12490dedfab67580d5039c1c96b2"><div class="ttname"><a href="classModuleMapper.html#ad68f12490dedfab67580d5039c1c96b2">ModuleMapper::getSvtIDFromHWChannel</a></div><div class="ttdeci">int getSvtIDFromHWChannel(int channel, std::string hwTag, std::map&lt; std::string, std::map&lt; int, int &gt;&gt; svtid_map)</div><div class="ttdoc">Return global svt id for channel by providing local channel number and F&lt;n&gt;H&lt;m&gt; of channel.</div><div class="ttdef"><b>Definition:</b> <a href="ModuleMapper_8cxx_source.html#l00532">ModuleMapper.cxx:532</a></div></div>
<div class="ttc" id="aclassModuleMapper_html_afda3474d4449108d05d301a5cc0ca08c"><div class="ttname"><a href="classModuleMapper.html#afda3474d4449108d05d301a5cc0ca08c">ModuleMapper::buildApvChannelMap</a></div><div class="ttdeci">void buildApvChannelMap()</div><div class="ttdoc">Used to generate apv channel map and read in thresholds from database.</div><div class="ttdef"><b>Definition:</b> <a href="ModuleMapper_8cxx_source.html#l00572">ModuleMapper.cxx:572</a></div></div>
<div class="ttc" id="anamespaceconfig_1_1fitBL__cfg_html_a95f2e9e3b2b2d837f962bcfb58a2011e"><div class="ttname"><a href="namespaceconfig_1_1fitBL__cfg.html#a95f2e9e3b2b2d837f962bcfb58a2011e">config.fitBL_cfg.layer</a></div><div class="ttdeci">layer</div><div class="ttdef"><b>Definition:</b> <a href="fitBL__cfg_8py_source.html#l00037">fitBL_cfg.py:37</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
