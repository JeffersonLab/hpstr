<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>hpstr: analysis/src/BumpHunter.cxx Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">hpstr
   </div>
   <div id="projectbrief">The Heavy Photon Search Toolkit for Reconstruction (hpstr) provides an interface to physics data from the HPS experiment saved in the LCIO format and converts it into an ROOT based format.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_b8678fa8510b7ff9a55ffd4d18fd5e47.html">analysis</a></li><li class="navelem"><a class="el" href="dir_bc66cf0f7bc2a011134b03d878d297c1.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">BumpHunter.cxx</div>  </div>
</div><!--header-->
<div class="contents">
<a href="BumpHunter_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160; </div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BumpHunter_8h.html">BumpHunter.h</a>&quot;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160; </div>
<div class="line"><a name="l00014"></a><span class="lineno"><a class="line" href="classBumpHunter.html#ac69da25e77c53cd89082a3d2c1a9a3ac">   14</a></span>&#160;<a class="code" href="classBumpHunter.html#ac69da25e77c53cd89082a3d2c1a9a3ac">BumpHunter::BumpHunter</a>(<a class="code" href="classFitFunction.html#a4be0c1a828439ca1afb1489b055636e6">FitFunction::BkgModel</a> model, <span class="keywordtype">int</span> <a class="code" href="namespaceconfig_1_1bhResSystematics__cfg.html#a448bf676d9cec8beea7ec942b1bda665">poly_order</a>, <span class="keywordtype">int</span> toy_poly_order, <span class="keywordtype">int</span> res_factor, <span class="keywordtype">double</span> res_scale, <span class="keywordtype">bool</span> asymptotic_limit)</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    : ofs(nullptr),</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;      res_factor_(res_factor), </div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;      poly_order_(<a class="code" href="namespaceconfig_1_1bhResSystematics__cfg.html#a448bf676d9cec8beea7ec942b1bda665">poly_order</a>),</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;      toy_poly_order_(toy_poly_order),</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;      asymptotic_limit_(asymptotic_limit),</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;      res_scale_(res_scale),</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;      bkg_model_(model) { }</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160; </div>
<div class="line"><a name="l00023"></a><span class="lineno"><a class="line" href="classBumpHunter.html#a70c926bc5e1c24e91380e4c4f66a7648">   23</a></span>&#160;<a class="code" href="classBumpHunter.html#a70c926bc5e1c24e91380e4c4f66a7648">BumpHunter::~BumpHunter</a>() { }</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160; </div>
<div class="line"><a name="l00025"></a><span class="lineno"><a class="line" href="classBumpHunter.html#a6049d3e75de41a68f8c1716f3be37139">   25</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classBumpHunter.html#a6049d3e75de41a68f8c1716f3be37139">BumpHunter::initialize</a>(TH1* histogram, <span class="keywordtype">double</span> &amp;mass_hypothesis) {</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <a class="code" href="classBumpHunter.html#a3abd15b0e3c354499407a3543dd13a31">mass_hypothesis_</a> = mass_hypothesis; </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="comment">//Set Minuit Minimizer options</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    ROOT::Math::MinimizerOptions::SetDefaultStrategy(2);</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="comment">// Shift the mass hypothesis so it sits in the middle of a bin.  </span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: Shifting mass hypothesis to nearest bin center &quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;              &lt;&lt; mass_hypothesis &lt;&lt; <span class="stringliteral">&quot; ---&gt; &quot;</span>; </div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="keywordtype">int</span> mbin = histogram-&gt;GetXaxis()-&gt;FindBin(mass_hypothesis);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <a class="code" href="classBumpHunter.html#a0d2d8d320125ed3797d8566faf918c89">bin_width_</a> = histogram-&gt;GetBinWidth(2);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: Histogram Bin Width is &quot;</span> &lt;&lt; <a class="code" href="classBumpHunter.html#a0d2d8d320125ed3797d8566faf918c89">bin_width_</a> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    mass_hypothesis = histogram-&gt;GetXaxis()-&gt;GetBinCenter(mbin);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    std::cout &lt;&lt; mass_hypothesis &lt;&lt; <span class="stringliteral">&quot; GeV&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    </div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="comment">// If the mass hypothesis is below the lower bound, throw an exception.  A </span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="comment">// search cannot be performed using an invalid value for the mass hypothesis.</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keywordflow">if</span>(mass_hypothesis &lt; <a class="code" href="classBumpHunter.html#ac334956f3e0c53dcaf9d71cc8ec5b523">lower_bound_</a>) {</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Mass hypothesis less than the lower bound!&quot;</span>);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    }</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="comment">// Correct the mass to take into account the mass scale systematic</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="comment">//corr_mass_ = correctMass(mass_hypothesis);</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="comment">//corr_mass_ = mass_hypothesis;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    </div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="comment">// Get the mass resolution at the corrected mass </span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <a class="code" href="classBumpHunter.html#af69acc2708c03aaae1cd620ccb39c5b2">mass_resolution_</a> = <a class="code" href="classBumpHunter.html#a6bd2e287952b5ae1739695702f163a2c">getMassResolution</a>(<a class="code" href="classBumpHunter.html#a3abd15b0e3c354499407a3543dd13a31">mass_hypothesis_</a>);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: Mass resolution: &quot;</span> &lt;&lt; <a class="code" href="classBumpHunter.html#af69acc2708c03aaae1cd620ccb39c5b2">mass_resolution_</a> &lt;&lt; <span class="stringliteral">&quot; GeV&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">// Calculate the fit window size</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <a class="code" href="classBumpHunter.html#a449e4ec04186381246a9c41514f16afb">window_size_</a> = 0;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classBumpHunter.html#acd40c1b855c9349b42b71fa452f71bae">window_use_res_scale_</a>) { <a class="code" href="classBumpHunter.html#a449e4ec04186381246a9c41514f16afb">window_size_</a> = <a class="code" href="classBumpHunter.html#ab8ef5199cc7df21b4170697aa872adf8">res_factor_</a> * <a class="code" href="classBumpHunter.html#af69acc2708c03aaae1cd620ccb39c5b2">mass_resolution_</a>; }</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordflow">else</span> { <a class="code" href="classBumpHunter.html#a449e4ec04186381246a9c41514f16afb">window_size_</a> = <a class="code" href="classBumpHunter.html#ab8ef5199cc7df21b4170697aa872adf8">res_factor_</a> * this-&gt;<a class="code" href="classBumpHunter.html#a6bd2e287952b5ae1739695702f163a2c">getMassResolution</a>(<a class="code" href="classBumpHunter.html#a3abd15b0e3c354499407a3543dd13a31">mass_hypothesis_</a>, 1.0); }</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    this-&gt;<a class="code" href="classBumpHunter.html#a31c941fca8bf7da62047b75da7aa6173">printDebug</a>(<span class="stringliteral">&quot;Window size: &quot;</span> + std::to_string(<a class="code" href="classBumpHunter.html#a449e4ec04186381246a9c41514f16afb">window_size_</a>));</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="comment">// Find the starting position of the window. This is set to the low edge of </span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">// the bin closest to the calculated value. If the start position falls </span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="comment">// below the lower bound of the histogram, set it to the lower bound.</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a> = mass_hypothesis - <a class="code" href="classBumpHunter.html#a449e4ec04186381246a9c41514f16afb">window_size_</a>/2;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordtype">int</span> window_start_bin = histogram-&gt;GetXaxis()-&gt;FindBin(<a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a>);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a> = histogram-&gt;GetXaxis()-&gt;GetBinLowEdge(window_start_bin);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a> &lt; <a class="code" href="classBumpHunter.html#ac334956f3e0c53dcaf9d71cc8ec5b523">lower_bound_</a>) {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: Starting edge of window (&quot;</span> &lt;&lt; <a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; MeV) is below lower bound.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        window_start_bin = histogram-&gt;GetXaxis()-&gt;FindBin(<a class="code" href="classBumpHunter.html#ac334956f3e0c53dcaf9d71cc8ec5b523">lower_bound_</a>);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a> = histogram-&gt;GetXaxis()-&gt;GetBinLowEdge(window_start_bin);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    }</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">// Find the end position of the window.  This is set to the lower edge of </span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">// the bin closest to the calculated value. If the window edge falls above</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">// the upper bound of the histogram, set it to the upper bound.</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="comment">// Furthermore, check that the bin serving as the upper boundary contains</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="comment">// events. If the upper bound is shifted, reset the lower window bound.</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a> = mass_hypothesis + <a class="code" href="classBumpHunter.html#a449e4ec04186381246a9c41514f16afb">window_size_</a>/2;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordtype">int</span> window_end_bin = histogram-&gt;GetXaxis()-&gt;FindBin(<a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a>);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a> = histogram-&gt;GetXaxis()-&gt;GetBinUpEdge(window_end_bin);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a> &gt; <a class="code" href="classBumpHunter.html#ad238d7648d7f332843b306a23231c5f0">upper_bound_</a>) {</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: Upper edge of window (&quot;</span> &lt;&lt; <a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; GeV) is above upper bound.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        window_end_bin = histogram-&gt;GetXaxis()-&gt;FindBin(<a class="code" href="classBumpHunter.html#ad238d7648d7f332843b306a23231c5f0">upper_bound_</a>);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        <span class="keywordtype">int</span> last_bin_above = histogram-&gt;FindLastBinAbove();</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="keywordflow">if</span>(window_end_bin &gt; last_bin_above) window_end_bin = last_bin_above;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a> = histogram-&gt;GetXaxis()-&gt;GetBinUpEdge(window_end_bin);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        window_start_bin = histogram-&gt;GetXaxis()-&gt;FindBin(<a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a> - <a class="code" href="classBumpHunter.html#a449e4ec04186381246a9c41514f16afb">window_size_</a>);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a> = histogram-&gt;GetXaxis()-&gt;GetBinLowEdge(window_start_bin);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    }</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <a class="code" href="classBumpHunter.html#a449e4ec04186381246a9c41514f16afb">window_size_</a> = <a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a> - <a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="classBumpHunter.html#a0ae706a937df6c29e470ecb811930de5">bins_</a> = window_end_bin - window_start_bin + 1;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: Setting starting edge of fit window to &quot;</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;              &lt;&lt; <a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a> &lt;&lt; <span class="stringliteral">&quot; GeV. Bin &quot;</span> &lt;&lt; window_start_bin &lt;&lt; std::endl;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: Setting upper edge of fit window to &quot;</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;              &lt;&lt; <a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a> &lt;&lt; <span class="stringliteral">&quot; GeV. Bin &quot;</span> &lt;&lt; window_end_bin &lt;&lt; std::endl;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: Total Number of Bins: &quot;</span> &lt;&lt; <a class="code" href="classBumpHunter.html#a0ae706a937df6c29e470ecb811930de5">bins_</a> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="comment">// Estimate the background normalization within the window by integrating</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="comment">// the histogram within the window range.  This should be close to the </span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">// background yield in the case where there is no signal present.</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <a class="code" href="classBumpHunter.html#aa31d0f96045ccea06ad2513c5b9cb625">integral_</a> = histogram-&gt;Integral(window_start_bin, window_end_bin);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: Integral within window: &quot;</span> &lt;&lt; <a class="code" href="classBumpHunter.html#aa31d0f96045ccea06ad2513c5b9cb625">integral_</a> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;}</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160; </div>
<div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="classBumpHunter.html#af3c76196a1177ca2e83af12c93a17ce4">  108</a></span>&#160;<a class="code" href="classHpsFitResult.html">HpsFitResult</a>* <a class="code" href="classBumpHunter.html#af3c76196a1177ca2e83af12c93a17ce4">BumpHunter::performSearch</a>(TH1* histogram, <span class="keywordtype">double</span> mass_hypothesis, <span class="keywordtype">bool</span> skip_bkg_fit, <span class="keywordtype">bool</span> skip_ul) {</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="comment">// Calculate all of the fit parameters e.g. window size, mass hypothesis</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <a class="code" href="classBumpHunter.html#a6049d3e75de41a68f8c1716f3be37139">initialize</a>(histogram, mass_hypothesis);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordtype">double</span> initNorm = log10(<a class="code" href="classBumpHunter.html#aa31d0f96045ccea06ad2513c5b9cb625">integral_</a>);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="comment">// Instantiate a new fit result object to store all of the results.</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <a class="code" href="classHpsFitResult.html">HpsFitResult</a>* fit_result = <span class="keyword">new</span> <a class="code" href="classHpsFitResult.html">HpsFitResult</a>();</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    fit_result-&gt;<a class="code" href="classHpsFitResult.html#a7602e2d11496a6a75d8ab5fae15b88a6">setPolyOrder</a>(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a>);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    fit_result-&gt;<a class="code" href="classHpsFitResult.html#a1f10cedd700440287d7ba0c30974a445">setBkgModelType</a>(<a class="code" href="classBumpHunter.html#ad64f64aaf5e929622312e05211e4b1b6">bkg_model_</a>);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160; </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="comment">// Determine whether to use an exponential polynomial or normal polynomial.</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keywordtype">bool</span> isChebyshev = (<a class="code" href="classBumpHunter.html#ad64f64aaf5e929622312e05211e4b1b6">bkg_model_</a> == FitFunction::BkgModel::CHEBYSHEV || <a class="code" href="classBumpHunter.html#ad64f64aaf5e929622312e05211e4b1b6">bkg_model_</a> == FitFunction::BkgModel::EXP_CHEBYSHEV);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keywordtype">bool</span> isExp = (<a class="code" href="classBumpHunter.html#ad64f64aaf5e929622312e05211e4b1b6">bkg_model_</a> == FitFunction::BkgModel::EXP_CHEBYSHEV || <a class="code" href="classBumpHunter.html#ad64f64aaf5e929622312e05211e4b1b6">bkg_model_</a> == FitFunction::BkgModel::EXP_LEGENDRE);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    TF1* bkg{<span class="keyword">nullptr</span>};</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    TF1* bkg_toys{<span class="keyword">nullptr</span>};</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Defining fit functions.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;    Model :: &quot;</span>;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classBumpHunter.html#ad64f64aaf5e929622312e05211e4b1b6">bkg_model_</a> == FitFunction::BkgModel::CHEBYSHEV) { std::cout &lt;&lt; <span class="stringliteral">&quot;Chebyshev Polynomial&quot;</span> &lt;&lt; std::endl; }</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classBumpHunter.html#ad64f64aaf5e929622312e05211e4b1b6">bkg_model_</a> == FitFunction::BkgModel::EXP_CHEBYSHEV) { std::cout &lt;&lt; <span class="stringliteral">&quot;Exponential Chebyshev Polynomial&quot;</span> &lt;&lt; std::endl; }</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classBumpHunter.html#ad64f64aaf5e929622312e05211e4b1b6">bkg_model_</a> == FitFunction::BkgModel::LEGENDRE) { std::cout &lt;&lt; <span class="stringliteral">&quot;Legendre Polynomial&quot;</span> &lt;&lt; std::endl; }</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classBumpHunter.html#ad64f64aaf5e929622312e05211e4b1b6">bkg_model_</a> == FitFunction::BkgModel::EXP_LEGENDRE) { std::cout &lt;&lt; <span class="stringliteral">&quot;Exponential Legendre Polynomial&quot;</span> &lt;&lt; std::endl; }</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;    Background Order :: &quot;</span>;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <a class="code" href="classFitFunction.html#a48da86489d89d37c13ad9e7443afb4ec">FitFunction::ModelOrder</a> bkg_order_model;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> == 1) {</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;1&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        bkg_order_model = FitFunction::ModelOrder::FIRST;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> == 3) {</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;3&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        bkg_order_model = FitFunction::ModelOrder::THIRD;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> == 5) {</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;5&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        bkg_order_model = FitFunction::ModelOrder::FIFTH;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    }</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    </div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;    Toy Generator Order :: &quot;</span>;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <a class="code" href="classFitFunction.html#a48da86489d89d37c13ad9e7443afb4ec">FitFunction::ModelOrder</a> toy_order_model;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classBumpHunter.html#a2d4f31bb10de8afd6aef3d5db65c67d3">toy_poly_order_</a> == 1) {</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;1&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        toy_order_model = FitFunction::ModelOrder::FIRST;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classBumpHunter.html#a2d4f31bb10de8afd6aef3d5db65c67d3">toy_poly_order_</a> == 3) {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;3&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        toy_order_model = FitFunction::ModelOrder::THIRD;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classBumpHunter.html#a2d4f31bb10de8afd6aef3d5db65c67d3">toy_poly_order_</a> == 5) {</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;5&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        toy_order_model = FitFunction::ModelOrder::FIFTH;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classBumpHunter.html#a2d4f31bb10de8afd6aef3d5db65c67d3">toy_poly_order_</a> == 7) {</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;7&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        toy_order_model = FitFunction::ModelOrder::SEVENTH;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    }</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="comment">// If not fitting toys, start by performing a background only fit.</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">if</span>(!skip_bkg_fit) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="comment">// Start by performing a background only fit.  The results from this fit </span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="comment">// are used to get an intial estimate of the background parameters.</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;*************************************************&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;*************************************************&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]:  Performing background only fits.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;*************************************************&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;*************************************************&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="comment">// Define the background-only fit model.</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="keywordflow">if</span>(isChebyshev) {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            <a class="code" href="classChebyshevFitFunction.html">ChebyshevFitFunction</a> bkg_func(mass_hypothesis, <a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a> - <a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a>, <a class="code" href="classBumpHunter.html#a0d2d8d320125ed3797d8566faf918c89">bin_width_</a>, bkg_order_model, FitFunction::SignalFitModel::NONE, isExp);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            bkg = <span class="keyword">new</span> TF1(<span class="stringliteral">&quot;bkg&quot;</span>, bkg_func, -1, 1, <a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 1);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            <a class="code" href="classLegendreFitFunction.html">LegendreFitFunction</a> bkg_func(mass_hypothesis, <a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a> - <a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a>, <a class="code" href="classBumpHunter.html#a0d2d8d320125ed3797d8566faf918c89">bin_width_</a>, bkg_order_model, FitFunction::SignalFitModel::NONE, isExp);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            bkg = <span class="keyword">new</span> TF1(<span class="stringliteral">&quot;bkg&quot;</span>, bkg_func, -1, 1, <a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 1);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        bkg-&gt;SetParameter(0, initNorm);</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        bkg-&gt;SetParName(0, <span class="stringliteral">&quot;pol0&quot;</span>);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 1; i &lt; <a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 1; i++) {</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            bkg-&gt;SetParameter(i, 0);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            bkg-&gt;SetParName(i, Form(<span class="stringliteral">&quot;pol%i&quot;</span>, i));</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        }</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="comment">// Define the toy generator fit model.</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="keywordflow">if</span>(isChebyshev) {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            <a class="code" href="classChebyshevFitFunction.html">ChebyshevFitFunction</a> bkg_toy_func(mass_hypothesis, <a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a> - <a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a>, <a class="code" href="classBumpHunter.html#a0d2d8d320125ed3797d8566faf918c89">bin_width_</a>, toy_order_model, FitFunction::SignalFitModel::NONE, isExp);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            bkg_toys = <span class="keyword">new</span> TF1(<span class="stringliteral">&quot;bkg_toys&quot;</span>, bkg_toy_func, -1, 1, <a class="code" href="classBumpHunter.html#a2d4f31bb10de8afd6aef3d5db65c67d3">toy_poly_order_</a> + 1);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            <a class="code" href="classLegendreFitFunction.html">LegendreFitFunction</a> bkg_toy_func(mass_hypothesis, <a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a> - <a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a>, <a class="code" href="classBumpHunter.html#a0d2d8d320125ed3797d8566faf918c89">bin_width_</a>, toy_order_model, FitFunction::SignalFitModel::NONE, isExp);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            bkg_toys = <span class="keyword">new</span> TF1(<span class="stringliteral">&quot;bkg_toys&quot;</span>, bkg_toy_func, -1, 1, <a class="code" href="classBumpHunter.html#a2d4f31bb10de8afd6aef3d5db65c67d3">toy_poly_order_</a> + 1);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        }</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        bkg_toys-&gt;SetParameter(0, initNorm);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        bkg_toys-&gt;SetParName(0, <span class="stringliteral">&quot;pol0&quot;</span>);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 1; i &lt; <a class="code" href="classBumpHunter.html#a2d4f31bb10de8afd6aef3d5db65c67d3">toy_poly_order_</a> + 1; i++) {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            bkg_toys-&gt;SetParameter(i, 0);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            bkg_toys-&gt;SetParName(i, Form(<span class="stringliteral">&quot;pol%i&quot;</span>, i));</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        }</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <span class="comment">// Perform the background-only fit and store the result.</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        TFitResultPtr result = histogram-&gt;Fit(<span class="stringliteral">&quot;bkg&quot;</span>, <span class="stringliteral">&quot;QLES+&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a>, <a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a>);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        fit_result-&gt;<a class="code" href="classHpsFitResult.html#ad3a7405505e0107be3e770cde19052ff">setBkgFitResult</a>(result);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160; </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;*************************************************&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;*************************************************&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]:  Performing background Toy fit.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;*************************************************&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;*************************************************&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160; </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="comment">// Perform the toy model fit and store the result.</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        TFitResultPtr result_toys = histogram-&gt;Fit(<span class="stringliteral">&quot;bkg_toys&quot;</span>, <span class="stringliteral">&quot;QLES+&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a>, <a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a>);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        fit_result-&gt;<a class="code" href="classHpsFitResult.html#aaf58002e96a9a78d0932a0f2d1ecc486">setBkgToysFitResult</a>(result_toys);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    }</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;***************************************************&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;***************************************************&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: Performing a signal+background fit.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;***************************************************&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;***************************************************&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    </div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    TF1* full{<span class="keyword">nullptr</span>};</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="comment">// Define the background+signal fit model.</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keywordflow">if</span>(isChebyshev) {</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <a class="code" href="classChebyshevFitFunction.html">ChebyshevFitFunction</a> full_func(mass_hypothesis, <a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a> - <a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a>, <a class="code" href="classBumpHunter.html#a0d2d8d320125ed3797d8566faf918c89">bin_width_</a>, bkg_order_model, FitFunction::SignalFitModel::GAUSSIAN, isExp);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        full = <span class="keyword">new</span> TF1(<span class="stringliteral">&quot;full&quot;</span>, full_func, -1, 1, <a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 4);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <a class="code" href="classLegendreFitFunction.html">LegendreFitFunction</a> full_func(mass_hypothesis, <a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a> - <a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a>, <a class="code" href="classBumpHunter.html#a0d2d8d320125ed3797d8566faf918c89">bin_width_</a>, bkg_order_model, FitFunction::SignalFitModel::GAUSSIAN, isExp);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        full = <span class="keyword">new</span> TF1(<span class="stringliteral">&quot;full&quot;</span>, full_func, -1, 1, <a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 4);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    }</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    full-&gt;SetParameter(0, initNorm);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    full-&gt;SetParName(0, <span class="stringliteral">&quot;pol0&quot;</span>);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    full-&gt;SetParameter(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 1, 0.0);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    full-&gt;SetParName(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 1, <span class="stringliteral">&quot;signal norm&quot;</span>);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    full-&gt;SetParName(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 2, <span class="stringliteral">&quot;mean&quot;</span>);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    full-&gt;SetParName(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 3, <span class="stringliteral">&quot;sigma&quot;</span>);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 1; i &lt; <a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 1; i++) {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        full-&gt;SetParameter(i, 0);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        full-&gt;SetParName(i, Form(<span class="stringliteral">&quot;pol%i&quot;</span>, i));</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    }</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    full-&gt;FixParameter(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 2, mass_hypothesis);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    full-&gt;FixParameter(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 3, <a class="code" href="classBumpHunter.html#af69acc2708c03aaae1cd620ccb39c5b2">mass_resolution_</a>);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> parI = 0; parI &lt; <a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 1; parI++) {</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        full-&gt;SetParameter(parI, bkg-&gt;GetParameter(parI));</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    TFitResultPtr full_result = histogram-&gt;Fit(<span class="stringliteral">&quot;full&quot;</span>, <span class="stringliteral">&quot;QLES+&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a>, <a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a>);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    fit_result-&gt;<a class="code" href="classHpsFitResult.html#a03216a940ea19c8f4f60c9407bb41e23">setCompFitResult</a>(full_result);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <a class="code" href="classBumpHunter.html#a3d28caaba9e4221b4fa810f329ffa73c">calculatePValue</a>(fit_result);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: Bkg Fit Status: &quot;</span> &lt;&lt; fit_result-&gt;<a class="code" href="classHpsFitResult.html#a1e62c1e3c4a18c09c0914aa6c0089e05">getBkgFitResult</a>()-&gt;IsValid() &lt;&lt;  std::endl;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: Bkg Toys Fit Status: &quot;</span> &lt;&lt; fit_result-&gt;<a class="code" href="classHpsFitResult.html#aed5f1bf530a1afa3c95da94063350554">getBkgToysFitResult</a>()-&gt;IsValid() &lt;&lt;  std::endl;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: Full Fit Status: &quot;</span> &lt;&lt; fit_result-&gt;<a class="code" href="classHpsFitResult.html#a35254fb98290afbfbe18e79fbed925cf">getCompFitResult</a>()-&gt;IsValid() &lt;&lt;  std::endl;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordflow">if</span>((!skip_ul) &amp;&amp; full_result-&gt;IsValid()) { <a class="code" href="classBumpHunter.html#ae5196e96a1d111b73a37c60050f9bef6">getUpperLimit</a>(histogram, fit_result); }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    </div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="comment">// Persist the mass hypothesis used for this fit</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    fit_result-&gt;<a class="code" href="classHpsFitResult.html#aaeda11bbf86fb26fa75aeccd0951e78f">setMass</a>(<a class="code" href="classBumpHunter.html#a3abd15b0e3c354499407a3543dd13a31">mass_hypothesis_</a>);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="comment">// Persist the mass after correcting for the mass scale</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    fit_result-&gt;<a class="code" href="classHpsFitResult.html#a8f4d95016e5f7fb7cc3274c2db9eef42">setCorrectedMass</a>(<a class="code" href="classBumpHunter.html#afef2ebdae7761aca3363b0352d8bc143">corr_mass_</a>);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="comment">// Set the window size</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    fit_result-&gt;<a class="code" href="classHpsFitResult.html#afa5c41c8e78f4a2d498c4e8f11f341c4">setWindowSize</a>(<a class="code" href="classBumpHunter.html#a449e4ec04186381246a9c41514f16afb">window_size_</a>);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="comment">// Set the total number of events within the window</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    fit_result-&gt;<a class="code" href="classHpsFitResult.html#a170955b89c0bf4ae1de1548bca6f6443">setIntegral</a>(<a class="code" href="classBumpHunter.html#aa31d0f96045ccea06ad2513c5b9cb625">integral_</a>);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">return</span> fit_result;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;}</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160; </div>
<div class="line"><a name="l00271"></a><span class="lineno"><a class="line" href="classBumpHunter.html#a3d28caaba9e4221b4fa810f329ffa73c">  271</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classBumpHunter.html#a3d28caaba9e4221b4fa810f329ffa73c">BumpHunter::calculatePValue</a>(<a class="code" href="classHpsFitResult.html">HpsFitResult</a>* result) {</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: Calculating p-value: &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordtype">double</span> signal_yield = result-&gt;<a class="code" href="classHpsFitResult.html#a35254fb98290afbfbe18e79fbed925cf">getCompFitResult</a>()-&gt;Parameter(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 1);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <a class="code" href="classBumpHunter.html#a31c941fca8bf7da62047b75da7aa6173">printDebug</a>(<span class="stringliteral">&quot;Signal yield: &quot;</span> + std::to_string(signal_yield));</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="comment">// In searching for a resonance, a signal is expected to lead to an </span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="comment">// excess of events.  In this case, a signal yield of &lt; 0 is  </span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="comment">// meaningless so we set the p-value = 1.  This follows the formulation</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="comment">// put forth by Cowen et al. in https://arxiv.org/pdf/1007.1727.pdf. </span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="comment">//if(signal_yield &lt;= 0) {</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="comment">//    result-&gt;setPValue(1);</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="comment">//    printDebug(&quot;Signal yield is negative ... setting p-value = 1&quot;);</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="comment">//    return;</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="comment">//}</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="comment">// Get the NLL obtained by minimizing the composite model with the signal</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="comment">// yield floating.</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordtype">double</span> mle_nll = result-&gt;<a class="code" href="classHpsFitResult.html#a35254fb98290afbfbe18e79fbed925cf">getCompFitResult</a>()-&gt;MinFcnValue();</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <a class="code" href="classBumpHunter.html#a31c941fca8bf7da62047b75da7aa6173">printDebug</a>(<span class="stringliteral">&quot;NLL when mu = &quot;</span> + std::to_string(signal_yield) + <span class="stringliteral">&quot;: &quot;</span> + std::to_string(mle_nll));</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="comment">// Get the NLL obtained from the Bkg only fit.</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordtype">double</span> bkg_nll = result-&gt;<a class="code" href="classHpsFitResult.html#a1e62c1e3c4a18c09c0914aa6c0089e05">getBkgFitResult</a>()-&gt;MinFcnValue();</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <a class="code" href="classBumpHunter.html#a31c941fca8bf7da62047b75da7aa6173">printDebug</a>(<span class="stringliteral">&quot;NLL when mu = 0: &quot;</span> + std::to_string(bkg_nll));</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="comment">// 1) Calculate the likelihood ratio which is chi2 distributed.</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="comment">// 2) From the chi2, calculate the p-value.</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordtype">double</span> q0 = 0;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordtype">double</span> p_value = 0;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <a class="code" href="classBumpHunter.html#a0057982066f25c66c20335bc159b6bf0">getChi2Prob</a>(bkg_nll, mle_nll, q0, p_value);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="comment">// Calculate r0 stat</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordtype">double</span> r0 = -2.0*(mle_nll - bkg_nll);</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keywordflow">if</span>(signal_yield &lt; 0.0 ) r0 = 2.0*(mle_nll - bkg_nll);</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <a class="code" href="classBumpHunter.html#a31c941fca8bf7da62047b75da7aa6173">printDebug</a>(<span class="stringliteral">&quot;r0: &quot;</span> + std::to_string(r0));</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <a class="code" href="classBumpHunter.html#a31c941fca8bf7da62047b75da7aa6173">printDebug</a>(<span class="stringliteral">&quot;Z0: &quot;</span> + std::to_string(r0*TMath::Sqrt(fabs(r0))/fabs(r0)));</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    p_value = 1 - ROOT::Math::gaussian_cdf( r0*TMath::Sqrt(fabs(r0))/fabs(r0) );</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: p-value: &quot;</span> &lt;&lt; p_value &lt;&lt; std::endl;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="comment">// Update the result</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    result-&gt;<a class="code" href="classHpsFitResult.html#aae9462e59fedc456ce82bb0de9f4204d">setPValue</a>(p_value);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    result-&gt;<a class="code" href="classHpsFitResult.html#a20e865f8fb2cd8d7de6ba27bcc3de629">setQ0</a>(q0);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;}</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; </div>
<div class="line"><a name="l00316"></a><span class="lineno"><a class="line" href="classBumpHunter.html#a31c941fca8bf7da62047b75da7aa6173">  316</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classBumpHunter.html#a31c941fca8bf7da62047b75da7aa6173">BumpHunter::printDebug</a>(std::string message) {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: &quot;</span> &lt;&lt; message &lt;&lt; std::endl;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;}</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160; </div>
<div class="line"><a name="l00320"></a><span class="lineno"><a class="line" href="classBumpHunter.html#ae5196e96a1d111b73a37c60050f9bef6">  320</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classBumpHunter.html#ae5196e96a1d111b73a37c60050f9bef6">BumpHunter::getUpperLimit</a>(TH1* histogram, <a class="code" href="classHpsFitResult.html">HpsFitResult</a>* result) {</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classBumpHunter.html#aecfe482d49262352e9a22b2bfadf8df7">asymptotic_limit_</a>) {</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <a class="code" href="classBumpHunter.html#a590f0aee7376661dd59c4ffa55299636">BumpHunter::getUpperLimitAsymCLs</a>(histogram, result);</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <a class="code" href="classBumpHunter.html#a47101d046517bdb11968ac8c6435a741">BumpHunter::getUpperLimitPower</a>(histogram, result);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;}</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; </div>
<div class="line"><a name="l00328"></a><span class="lineno"><a class="line" href="classBumpHunter.html#a4cfe5da84bfe10b4135cb4ee6b1be2b5">  328</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classBumpHunter.html#a4cfe5da84bfe10b4135cb4ee6b1be2b5">BumpHunter::getUpperLimitAsymptotic</a>(TH1* histogram, <a class="code" href="classHpsFitResult.html">HpsFitResult</a>* result) {</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: Calculating upper limit.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="comment">// Get the signal yield and signal yield error.</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="keywordtype">double</span> signal_yield = result-&gt;<a class="code" href="classHpsFitResult.html#a35254fb98290afbfbe18e79fbed925cf">getCompFitResult</a>()-&gt;Parameter(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 1);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="keywordflow">if</span>(signal_yield &lt; 0) { signal_yield = 0; }</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordtype">double</span> signal_yield_error = result-&gt;<a class="code" href="classHpsFitResult.html#a35254fb98290afbfbe18e79fbed925cf">getCompFitResult</a>()-&gt;ParError(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 1);</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="comment">// Debug print the signal yield and its error.</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Signal Yield       :: &quot;</span> &lt;&lt; signal_yield &lt;&lt; std::endl;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Signal Yield Error :: &quot;</span> &lt;&lt; signal_yield_error &lt;&lt; std::endl;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="comment">// Calculate the upper limit according to Equation (69) of &quot;Asymptotic formulae</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="comment">// for likelihood-based tests of new physics&quot; by Cowan et alii. 1.64 is derived</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="comment">// from Equation (1) for a 95% confidence level (alpha = 0.05).</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordtype">double</span> upper_limit = signal_yield + 1.64 * signal_yield_error;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    </div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="comment">// The p-value is 0.05 by definition.</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordtype">double</span> p_value = 0.05;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    </div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="comment">// Debug print the upper limit.</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Upper Limit        :: &quot;</span> &lt;&lt; upper_limit &lt;&lt; std::endl;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;p-Value            :: &quot;</span> &lt;&lt; p_value &lt;&lt; std::endl;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    </div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="comment">// Set the upper limit and upper limit p-value.</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    result-&gt;<a class="code" href="classHpsFitResult.html#aca22f27f6f5e945edb5afb016f5dde05">setUpperLimit</a>(upper_limit);</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    result-&gt;<a class="code" href="classHpsFitResult.html#aebdfc27cc0ab451a91d8708c93ed3f97">setUpperLimitPValue</a>(p_value);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;}</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160; </div>
<div class="line"><a name="l00357"></a><span class="lineno"><a class="line" href="classBumpHunter.html#a590f0aee7376661dd59c4ffa55299636">  357</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classBumpHunter.html#a590f0aee7376661dd59c4ffa55299636">BumpHunter::getUpperLimitAsymCLs</a>(TH1* histogram, <a class="code" href="classHpsFitResult.html">HpsFitResult</a>* result) {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="comment">// Determine whether to use an exponential polynomial or normal polynomial.</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordtype">bool</span> isChebyshev = (<a class="code" href="classBumpHunter.html#ad64f64aaf5e929622312e05211e4b1b6">bkg_model_</a> == FitFunction::BkgModel::CHEBYSHEV || <a class="code" href="classBumpHunter.html#ad64f64aaf5e929622312e05211e4b1b6">bkg_model_</a> == FitFunction::BkgModel::EXP_CHEBYSHEV);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="keywordtype">bool</span> isExp = (<a class="code" href="classBumpHunter.html#ad64f64aaf5e929622312e05211e4b1b6">bkg_model_</a> == FitFunction::BkgModel::EXP_CHEBYSHEV || <a class="code" href="classBumpHunter.html#ad64f64aaf5e929622312e05211e4b1b6">bkg_model_</a> == FitFunction::BkgModel::EXP_LEGENDRE);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keywordtype">double</span> initNorm = log10(<a class="code" href="classBumpHunter.html#aa31d0f96045ccea06ad2513c5b9cb625">integral_</a>);</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    </div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="comment">// Instantiate a fit function for the appropriate polynomial order.</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    TF1* comp{<span class="keyword">nullptr</span>};</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <a class="code" href="classFitFunction.html#a48da86489d89d37c13ad9e7443afb4ec">FitFunction::ModelOrder</a> bkg_order_model;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> == 1) { bkg_order_model = FitFunction::ModelOrder::FIRST; }</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> == 3) { bkg_order_model = FitFunction::ModelOrder::THIRD; }</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> == 5) { bkg_order_model = FitFunction::ModelOrder::FIFTH; }</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordflow">if</span>(isChebyshev) {</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <a class="code" href="classChebyshevFitFunction.html">ChebyshevFitFunction</a> comp_func(<a class="code" href="classBumpHunter.html#a3abd15b0e3c354499407a3543dd13a31">mass_hypothesis_</a>, <a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a> - <a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a>, <a class="code" href="classBumpHunter.html#a0d2d8d320125ed3797d8566faf918c89">bin_width_</a>, bkg_order_model, FitFunction::SignalFitModel::GAUSSIAN, isExp);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        comp = <span class="keyword">new</span> TF1(<span class="stringliteral">&quot;comp_ul&quot;</span>, comp_func, -1, 1, <a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 4);</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <a class="code" href="classLegendreFitFunction.html">LegendreFitFunction</a> comp_func(<a class="code" href="classBumpHunter.html#a3abd15b0e3c354499407a3543dd13a31">mass_hypothesis_</a>, <a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a> - <a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a>, <a class="code" href="classBumpHunter.html#a0d2d8d320125ed3797d8566faf918c89">bin_width_</a>, bkg_order_model, FitFunction::SignalFitModel::GAUSSIAN, isExp);</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        comp = <span class="keyword">new</span> TF1(<span class="stringliteral">&quot;comp_ul&quot;</span>, comp_func, -1, 1, <a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 4);</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    }</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    comp-&gt;SetParameter(0, initNorm);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    comp-&gt;SetParName(0, <span class="stringliteral">&quot;pol0&quot;</span>);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    comp-&gt;SetParameter(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 1, 0.0);</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    comp-&gt;SetParName(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 1, <span class="stringliteral">&quot;signal norm&quot;</span>);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    comp-&gt;SetParName(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 2, <span class="stringliteral">&quot;mean&quot;</span>);</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    comp-&gt;SetParName(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 3, <span class="stringliteral">&quot;sigma&quot;</span>);</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 1; i &lt; <a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 1; i++) {</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        comp-&gt;SetParameter(i, 0);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        comp-&gt;SetParName(i, Form(<span class="stringliteral">&quot;pol%i&quot;</span>, i));</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    }</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    comp-&gt;FixParameter(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 2, <a class="code" href="classBumpHunter.html#a3abd15b0e3c354499407a3543dd13a31">mass_hypothesis_</a>);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    comp-&gt;FixParameter(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 3, <a class="code" href="classBumpHunter.html#af69acc2708c03aaae1cd620ccb39c5b2">mass_resolution_</a>);</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="comment">//for(int parI = 1; parI &lt; poly_order_ + 1; parI++) {</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="comment">//    comp-&gt;FixParameter(parI, result-&gt;getCompFitResult()-&gt;Parameter(parI));</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="comment">//}</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    </div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Mass resolution: &quot;</span> &lt;&lt; <a class="code" href="classBumpHunter.html#af69acc2708c03aaae1cd620ccb39c5b2">mass_resolution_</a> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: Calculating upper limit.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="comment">//  Get the signal yield obtained from the signal+bkg fit</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordtype">double</span> mu_hat = result-&gt;<a class="code" href="classHpsFitResult.html#a35254fb98290afbfbe18e79fbed925cf">getCompFitResult</a>()-&gt;Parameter(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 1);</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordtype">double</span> sigma = result-&gt;<a class="code" href="classHpsFitResult.html#a35254fb98290afbfbe18e79fbed925cf">getCompFitResult</a>()-&gt;ParError(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 1);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <a class="code" href="classBumpHunter.html#a31c941fca8bf7da62047b75da7aa6173">printDebug</a>(<span class="stringliteral">&quot;Signal yield: &quot;</span> + std::to_string(mu_hat));</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <a class="code" href="classBumpHunter.html#a31c941fca8bf7da62047b75da7aa6173">printDebug</a>(<span class="stringliteral">&quot;Sigma: &quot;</span> + std::to_string(sigma));</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    </div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="comment">// Get the minimum NLL value that will be used for testing upper limits.</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordtype">double</span> mle_nll = result-&gt;<a class="code" href="classHpsFitResult.html#a35254fb98290afbfbe18e79fbed925cf">getCompFitResult</a>()-&gt;MinFcnValue();</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="comment">// Get the NLL obtained assuming the background only hypothesis</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keywordtype">double</span> bkg_nll = result-&gt;<a class="code" href="classHpsFitResult.html#a1e62c1e3c4a18c09c0914aa6c0089e05">getBkgFitResult</a>()-&gt;MinFcnValue();</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160; </div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <a class="code" href="classBumpHunter.html#a31c941fca8bf7da62047b75da7aa6173">printDebug</a>(<span class="stringliteral">&quot;MLE NLL: &quot;</span> + std::to_string(mle_nll));</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <a class="code" href="classBumpHunter.html#a31c941fca8bf7da62047b75da7aa6173">printDebug</a>(<span class="stringliteral">&quot;mu=0 NLL: &quot;</span> + std::to_string(bkg_nll));</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    </div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordtype">double</span> mu95up = fabs(mu_hat + 1.64*sigma); <span class="comment">//This should give us something close to start</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    </div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keywordtype">double</span> CLs = 1.0;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordtype">double</span> p_mu = 1;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="keywordtype">double</span> p_b = 1;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordtype">double</span> r_mu = -9999999.9;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordtype">int</span> tryN = 0;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="keywordflow">while</span>(<span class="keyword">true</span>) {</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        tryN++;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        comp-&gt;FixParameter(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 1, mu95up);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        </div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        TFitResultPtr full_result = histogram-&gt;Fit(<span class="stringliteral">&quot;comp_ul&quot;</span>, <span class="stringliteral">&quot;NQLES&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a>, <a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a>);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        <span class="keywordtype">double</span> mu_nll = full_result-&gt;MinFcnValue();</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160; </div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        <span class="keywordtype">double</span> nllamb_mu = mu_nll - mle_nll;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        <span class="keywordflow">if</span>(mu_hat &lt; 0.0) nllamb_mu = mu_nll - bkg_nll;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        r_mu = 2.0*nllamb_mu;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <span class="keywordflow">if</span>(mu_hat &gt; mu95up) r_mu = -2.0*nllamb_mu;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160; </div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        <span class="keywordflow">if</span>(r_mu &lt; 0.0)</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        {</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;            p_mu = 1.0 - ROOT::Math::gaussian_cdf( -1.0*TMath::Sqrt(-1.0*r_mu) );</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;            p_b =  1.0 - ROOT::Math::gaussian_cdf( -1.0*TMath::Sqrt(-1.0*r_mu) - (mu95up/sigma) );</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        }</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(r_mu &gt; mu95up*mu95up/(sigma*sigma))</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        {</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            p_mu =  1.0 - ROOT::Math::gaussian_cdf( (r_mu + mu95up*mu95up/(sigma*sigma))/(2.0*mu95up/sigma) );</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            p_b =   1.0 - ROOT::Math::gaussian_cdf( (r_mu - mu95up*mu95up/(sigma*sigma))/(2.0*mu95up/sigma) );</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        }</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        {</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            p_mu = 1.0 - ROOT::Math::gaussian_cdf( TMath::Sqrt(r_mu) );</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            p_b =  1.0 - ROOT::Math::gaussian_cdf( TMath::Sqrt(r_mu) - (mu95up/sigma) );</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        }</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160; </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        </div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        CLs = p_mu/p_b;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        </div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: mu: &quot;</span> &lt;&lt; mu95up &lt;&lt; std::endl;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: mle_nll: &quot;</span> &lt;&lt; mle_nll &lt;&lt; std::endl;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: bkg_nll: &quot;</span> &lt;&lt; bkg_nll &lt;&lt; std::endl;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: mu_nll: &quot;</span> &lt;&lt; mu_nll &lt;&lt; std::endl;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: nllamb_mu: &quot;</span> &lt;&lt; nllamb_mu &lt;&lt; std::endl;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: r_mu: &quot;</span> &lt;&lt; r_mu &lt;&lt; std::endl;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: p_mu: &quot;</span> &lt;&lt; p_mu &lt;&lt; std::endl;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: p_b: &quot;</span> &lt;&lt; p_b &lt;&lt; std::endl;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: CLs: &quot;</span> &lt;&lt; CLs &lt;&lt; std::endl;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <span class="keywordflow">if</span>(tryN &gt; 1000) </div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        {</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: Upper limit aborting, too many tries&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            </div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;            result-&gt;<a class="code" href="classHpsFitResult.html#aca22f27f6f5e945edb5afb016f5dde05">setUpperLimit</a>(1.64*sigma);</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            result-&gt;<a class="code" href="classHpsFitResult.html#aebdfc27cc0ab451a91d8708c93ed3f97">setUpperLimitPValue</a>(-9.0);</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            </div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        } </div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <span class="keywordflow">if</span>((CLs &lt;= 0.051 &amp;&amp; CLs &gt; 0.049)) </div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        {</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: Upper limit: &quot;</span> &lt;&lt; mu95up &lt;&lt; std::endl;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: CLs: &quot;</span> &lt;&lt; CLs &lt;&lt; std::endl;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            </div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            result-&gt;<a class="code" href="classHpsFitResult.html#aca22f27f6f5e945edb5afb016f5dde05">setUpperLimit</a>(mu95up);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            result-&gt;<a class="code" href="classHpsFitResult.html#aebdfc27cc0ab451a91d8708c93ed3f97">setUpperLimitPValue</a>(CLs);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;            </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        } </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(CLs &lt;= 1e-10) { mu95up = mu95up*0.1; }</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(CLs &lt;= 1e-8) { mu95up = mu95up*0.5; }</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(CLs &lt;= 1e-4) { mu95up = mu95up*0.8; }</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(CLs &lt;= 0.01) { mu95up = mu95up*0.9; }</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(CLs &lt;= 0.04) { mu95up = mu95up*0.99; }</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(CLs &lt;= 0.049) { mu95up = mu95up*0.999; }</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(CLs &lt;= 0.1) { mu95up = mu95up*1.01; }</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        <span class="keywordflow">else</span> { mu95up = mu95up*1.1; }</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        <a class="code" href="classBumpHunter.html#a31c941fca8bf7da62047b75da7aa6173">printDebug</a>(<span class="stringliteral">&quot;Setting mu to: &quot;</span> + std::to_string(mu95up));</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    }</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;}</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160; </div>
<div class="line"><a name="l00489"></a><span class="lineno"><a class="line" href="classBumpHunter.html#a47101d046517bdb11968ac8c6435a741">  489</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classBumpHunter.html#a47101d046517bdb11968ac8c6435a741">BumpHunter::getUpperLimitPower</a>(TH1* histogram, <a class="code" href="classHpsFitResult.html">HpsFitResult</a>* result) {</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="comment">// Determine whether to use an exponential polynomial or normal polynomial.</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="keywordtype">bool</span> isChebyshev = (<a class="code" href="classBumpHunter.html#ad64f64aaf5e929622312e05211e4b1b6">bkg_model_</a> == FitFunction::BkgModel::CHEBYSHEV || <a class="code" href="classBumpHunter.html#ad64f64aaf5e929622312e05211e4b1b6">bkg_model_</a> == FitFunction::BkgModel::EXP_CHEBYSHEV);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordtype">bool</span> isExp = (<a class="code" href="classBumpHunter.html#ad64f64aaf5e929622312e05211e4b1b6">bkg_model_</a> == FitFunction::BkgModel::EXP_CHEBYSHEV || <a class="code" href="classBumpHunter.html#ad64f64aaf5e929622312e05211e4b1b6">bkg_model_</a> == FitFunction::BkgModel::EXP_LEGENDRE);</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keywordtype">double</span> initNorm = log10(<a class="code" href="classBumpHunter.html#aa31d0f96045ccea06ad2513c5b9cb625">integral_</a>);</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    </div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="comment">// Instantiate a fit function for the appropriate polynomial order.</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    TF1* comp{<span class="keyword">nullptr</span>};</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <a class="code" href="classFitFunction.html#a48da86489d89d37c13ad9e7443afb4ec">FitFunction::ModelOrder</a> bkg_order_model;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> == 1) { bkg_order_model = FitFunction::ModelOrder::FIRST; }</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> == 3) { bkg_order_model = FitFunction::ModelOrder::THIRD; }</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> == 5) { bkg_order_model = FitFunction::ModelOrder::FIFTH; }</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="keywordflow">if</span>(isChebyshev) {</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <a class="code" href="classChebyshevFitFunction.html">ChebyshevFitFunction</a> comp_func(<a class="code" href="classBumpHunter.html#a3abd15b0e3c354499407a3543dd13a31">mass_hypothesis_</a>, <a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a> - <a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a>, <a class="code" href="classBumpHunter.html#a0d2d8d320125ed3797d8566faf918c89">bin_width_</a>, bkg_order_model, FitFunction::SignalFitModel::GAUSSIAN, isExp);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        comp = <span class="keyword">new</span> TF1(<span class="stringliteral">&quot;comp_ul&quot;</span>, comp_func, -1, 1, <a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 4);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <a class="code" href="classLegendreFitFunction.html">LegendreFitFunction</a> comp_func(<a class="code" href="classBumpHunter.html#a3abd15b0e3c354499407a3543dd13a31">mass_hypothesis_</a>, <a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a> - <a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a>, <a class="code" href="classBumpHunter.html#a0d2d8d320125ed3797d8566faf918c89">bin_width_</a>, bkg_order_model, FitFunction::SignalFitModel::GAUSSIAN, isExp);</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        comp = <span class="keyword">new</span> TF1(<span class="stringliteral">&quot;comp_ul&quot;</span>, comp_func, -1, 1, <a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 4);</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    }</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    comp-&gt;SetParameter(0, initNorm);</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    comp-&gt;SetParName(0, <span class="stringliteral">&quot;pol0&quot;</span>);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    comp-&gt;SetParameter(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 1, 0.0);</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    comp-&gt;SetParName(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 1, <span class="stringliteral">&quot;signal norm&quot;</span>);</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    comp-&gt;SetParName(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 2, <span class="stringliteral">&quot;mean&quot;</span>);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    comp-&gt;SetParName(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 3, <span class="stringliteral">&quot;sigma&quot;</span>);</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 1; i &lt; <a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 1; i++) {</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        comp-&gt;SetParameter(i, 0);</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        comp-&gt;SetParName(i, Form(<span class="stringliteral">&quot;pol%i&quot;</span>, i));</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    }</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    comp-&gt;FixParameter(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 2, <a class="code" href="classBumpHunter.html#a3abd15b0e3c354499407a3543dd13a31">mass_hypothesis_</a>);</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    comp-&gt;FixParameter(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 3, <a class="code" href="classBumpHunter.html#af69acc2708c03aaae1cd620ccb39c5b2">mass_resolution_</a>);</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    </div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Mass resolution: &quot;</span> &lt;&lt; <a class="code" href="classBumpHunter.html#af69acc2708c03aaae1cd620ccb39c5b2">mass_resolution_</a> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: Calculating upper limit.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    </div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="comment">//  Get the signal yield obtained from the signal+bkg fit</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keywordtype">double</span> signal_yield = result-&gt;<a class="code" href="classHpsFitResult.html#a35254fb98290afbfbe18e79fbed925cf">getCompFitResult</a>()-&gt;Parameter(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 1);</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <a class="code" href="classBumpHunter.html#a31c941fca8bf7da62047b75da7aa6173">printDebug</a>(<span class="stringliteral">&quot;Signal yield: &quot;</span> + std::to_string(signal_yield));</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    </div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="comment">// Get the minimum NLL value that will be used for testing upper limits.</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="comment">// If the signal yield (mu estimator) at the min NLL is &lt; 0, use the NLL</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="comment">// obtained when mu = 0.</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keywordtype">double</span> mle_nll = result-&gt;<a class="code" href="classHpsFitResult.html#a35254fb98290afbfbe18e79fbed925cf">getCompFitResult</a>()-&gt;MinFcnValue();</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    </div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="keywordflow">if</span>(signal_yield &lt; 0) {</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        <a class="code" href="classBumpHunter.html#a31c941fca8bf7da62047b75da7aa6173">printDebug</a>(<span class="stringliteral">&quot;Signal yield @ min NLL is &lt; 0. Using NLL when signal yield = 0&quot;</span>);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        </div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        <span class="comment">// Get the NLL obtained assuming the background only hypothesis</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        mle_nll = result-&gt;<a class="code" href="classHpsFitResult.html#a1e62c1e3c4a18c09c0914aa6c0089e05">getBkgFitResult</a>()-&gt;MinFcnValue();</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        </div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        signal_yield = 0;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    }</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <a class="code" href="classBumpHunter.html#a31c941fca8bf7da62047b75da7aa6173">printDebug</a>(<span class="stringliteral">&quot;MLE NLL: &quot;</span> + std::to_string(mle_nll));</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    </div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    signal_yield = floor(signal_yield) + 1;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    </div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="keywordtype">double</span> p_value = 1;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="keywordtype">double</span> q0 = 0;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="keywordflow">while</span>(<span class="keyword">true</span>) {</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        <a class="code" href="classBumpHunter.html#a31c941fca8bf7da62047b75da7aa6173">printDebug</a>(<span class="stringliteral">&quot;Setting signal yield to: &quot;</span> + std::to_string(signal_yield));</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <span class="comment">//std::cout &lt;&lt; &quot;[ BumpHunter ]: Current p-value: &quot; &lt;&lt; p_value &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        comp-&gt;FixParameter(<a class="code" href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">poly_order_</a> + 1, signal_yield);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        </div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        TFitResultPtr full_result = histogram-&gt;Fit(<span class="stringliteral">&quot;comp_ul&quot;</span>, <span class="stringliteral">&quot;QLES+&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a>, <a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a>);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <span class="keywordtype">double</span> cond_nll = full_result-&gt;MinFcnValue();</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        </div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        <span class="comment">// 1) Calculate the likelihood ratio which is chi2 distributed.</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        <span class="comment">// 2) From the chi2, calculate the p-value.</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <a class="code" href="classBumpHunter.html#a0057982066f25c66c20335bc159b6bf0">getChi2Prob</a>(cond_nll, mle_nll, q0, p_value);</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        </div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <a class="code" href="classBumpHunter.html#a31c941fca8bf7da62047b75da7aa6173">printDebug</a>(<span class="stringliteral">&quot;p-value after fit : &quot;</span> + std::to_string(p_value));</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: Current Signal Yield: &quot;</span> &lt;&lt; signal_yield &lt;&lt; std::endl;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: Current p-value: &quot;</span> &lt;&lt; p_value &lt;&lt; std::endl;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        </div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        <span class="keywordflow">if</span>((p_value &lt;= 0.0455 &amp;&amp; p_value &gt; 0.044)) {</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: Upper limit: &quot;</span> &lt;&lt; signal_yield &lt;&lt; std::endl;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: p-value: &quot;</span> &lt;&lt; p_value &lt;&lt; std::endl;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            </div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;            result-&gt;<a class="code" href="classHpsFitResult.html#aca22f27f6f5e945edb5afb016f5dde05">setUpperLimit</a>(signal_yield);</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;            result-&gt;<a class="code" href="classHpsFitResult.html#aebdfc27cc0ab451a91d8708c93ed3f97">setUpperLimitPValue</a>(p_value);</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            </div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (signal_yield &lt;= 0 &amp;&amp; p_value &lt; 0.044) {</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: Caution Background Model suspicious!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: Upper limit: &quot;</span> &lt;&lt; signal_yield &lt;&lt; std::endl;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;[ BumpHunter ]: p-value: &quot;</span> &lt;&lt; p_value &lt;&lt; std::endl;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            </div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            result-&gt;<a class="code" href="classHpsFitResult.html#aca22f27f6f5e945edb5afb016f5dde05">setUpperLimit</a>(signal_yield);</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            result-&gt;<a class="code" href="classHpsFitResult.html#aebdfc27cc0ab451a91d8708c93ed3f97">setUpperLimitPValue</a>(p_value);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            </div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        }</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(p_value &lt;= 0.044) { signal_yield -= 1; }</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(p_value &lt;= 0.059) { signal_yield += 10; }</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(p_value &lt;= 0.10) { signal_yield += 20; }</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(p_value &lt;= 0.2) { signal_yield += 40; }</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        <span class="keywordflow">else</span> { signal_yield += 100; }</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    }</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;}</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160; </div>
<div class="line"><a name="l00589"></a><span class="lineno"><a class="line" href="classBumpHunter.html#aded2f9f6064603451dd5ee2087a4744b">  589</a></span>&#160;std::vector&lt;TH1*&gt; <a class="code" href="classBumpHunter.html#aded2f9f6064603451dd5ee2087a4744b">BumpHunter::generateToys</a>(TH1* histogram, <span class="keywordtype">double</span> n_toys, <span class="keywordtype">int</span> seed, <span class="keywordtype">int</span> toy_sig_samples, <span class="keywordtype">int</span> bkg_mult, TH1* signal_hist) {</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    gRandom-&gt;SetSeed(seed);</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    </div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    TF1* bkg_toys = histogram-&gt;GetFunction(<span class="stringliteral">&quot;bkg_toys&quot;</span>);</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    TF1* sig_toys = <span class="keyword">new</span> TF1(<span class="stringliteral">&quot;sig_toys&quot;</span>, <span class="stringliteral">&quot;gaus&quot;</span>, <a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a>, <a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a>);</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    sig_toys-&gt;SetParameters(1.0, <a class="code" href="classBumpHunter.html#a3abd15b0e3c354499407a3543dd13a31">mass_hypothesis_</a>, <a class="code" href="classBumpHunter.html#af69acc2708c03aaae1cd620ccb39c5b2">mass_resolution_</a>);</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    </div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    std::vector&lt;TH1*&gt; hists;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="keywordtype">int</span> bkg_events = bkg_mult * <a class="code" href="namespaceconfig_1_1anaKalSimpTuple__cfg.html#a61569f2965b7a369eb10b6d75d410d11">int</a>(<a class="code" href="classBumpHunter.html#aa31d0f96045ccea06ad2513c5b9cb625">integral_</a>);</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> itoy = 0; itoy &lt; n_toys; ++itoy) {</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        std::string name = <span class="stringliteral">&quot;invariant_mass_&quot;</span> + std::to_string(itoy);</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <span class="keywordflow">if</span>(itoy%100 == 0) {</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;Generating Toy &quot;</span> &lt;&lt; itoy &lt;&lt; std::endl;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        }</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        TH1F* hist = <span class="keyword">new</span> TH1F(name.c_str(), name.c_str(), <a class="code" href="classBumpHunter.html#a0ae706a937df6c29e470ecb811930de5">bins_</a>, <a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a>, <a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a>);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; bkg_events; ++i) {</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            hist-&gt;Fill(bkg_toys-&gt;GetRandom(<a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a>, <a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a>));</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        }</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; toy_sig_samples; i++) {</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            <span class="keywordtype">double</span> sig_sample = 0;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            <span class="keywordflow">if</span>(signal_hist != NULL) { sig_sample = signal_hist-&gt;GetRandom(); }</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;            <span class="keywordflow">else</span> { sig_sample = sig_toys-&gt;GetRandom(<a class="code" href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">window_start_</a>, <a class="code" href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">window_end_</a>); }</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            hist-&gt;Fill(sig_sample);</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        }</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        hists.push_back(hist); </div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    }</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    </div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <span class="keywordflow">return</span> hists;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;}</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160; </div>
<div class="line"><a name="l00619"></a><span class="lineno"><a class="line" href="classBumpHunter.html#a0057982066f25c66c20335bc159b6bf0">  619</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classBumpHunter.html#a0057982066f25c66c20335bc159b6bf0">BumpHunter::getChi2Prob</a>(<span class="keywordtype">double</span> cond_nll, <span class="keywordtype">double</span> mle_nll, <span class="keywordtype">double</span> &amp;q0, <span class="keywordtype">double</span> &amp;p_value) {</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="comment">//printDebug(&quot;Cond NLL: &quot; + std::to_string(cond_nll));</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="comment">//printDebug(&quot;Uncod NLL: &quot; + std::to_string(mle_nll));</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keywordtype">double</span> diff = cond_nll - mle_nll;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="comment">//printDebug(&quot;Delta NLL: &quot; + std::to_string(diff));</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    </div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    q0 = 2 * diff;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="comment">//printDebug(&quot;q0: &quot; + std::to_string(q0));</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    </div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    p_value = ROOT::Math::chisquared_cdf_c(q0, 1);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="comment">//printDebug(&quot;p-value before dividing: &quot; + std::to_string(p_value));</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    p_value *= 0.5;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="comment">//printDebug(&quot;p-value: &quot; + std::to_string(p_value));</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;}</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160; </div>
<div class="line"><a name="l00634"></a><span class="lineno"><a class="line" href="classBumpHunter.html#ad9ecd75afa199886f0a8bfed07bd4466">  634</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classBumpHunter.html#ad9ecd75afa199886f0a8bfed07bd4466">BumpHunter::setBounds</a>(<span class="keywordtype">double</span> lower_bound, <span class="keywordtype">double</span> upper_bound) {</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <a class="code" href="classBumpHunter.html#ac334956f3e0c53dcaf9d71cc8ec5b523">lower_bound_</a> = lower_bound;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <a class="code" href="classBumpHunter.html#ad238d7648d7f332843b306a23231c5f0">upper_bound_</a> = upper_bound;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    printf(<span class="stringliteral">&quot;Fit bounds set to [ %f , %f ]\n&quot;</span>, <a class="code" href="classBumpHunter.html#ac334956f3e0c53dcaf9d71cc8ec5b523">lower_bound_</a>, <a class="code" href="classBumpHunter.html#ad238d7648d7f332843b306a23231c5f0">upper_bound_</a>);</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;}</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160; </div>
<div class="line"><a name="l00640"></a><span class="lineno"><a class="line" href="classBumpHunter.html#a33613c572796670d8d23b2d14832ba01">  640</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="classBumpHunter.html#a33613c572796670d8d23b2d14832ba01">BumpHunter::correctMass</a>(<span class="keywordtype">double</span> mass) {</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="keywordtype">double</span> offset = -1.19892320e4 * pow(mass, 3) + 1.50196798e3 * pow(mass, 2) - 8.38873712e1 * mass + 6.23215746;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    offset /= 100;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <a class="code" href="classBumpHunter.html#a31c941fca8bf7da62047b75da7aa6173">printDebug</a>(<span class="stringliteral">&quot;Offset: &quot;</span> + std::to_string(offset));</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="keywordtype">double</span> cmass = mass - mass * offset;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <a class="code" href="classBumpHunter.html#a31c941fca8bf7da62047b75da7aa6173">printDebug</a>(<span class="stringliteral">&quot;Corrected Mass: &quot;</span> + std::to_string(cmass));</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="keywordflow">return</span> cmass;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;}</div>
<div class="ttc" id="aBumpHunter_8h_html"><div class="ttname"><a href="BumpHunter_8h.html">BumpHunter.h</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_a0057982066f25c66c20335bc159b6bf0"><div class="ttname"><a href="classBumpHunter.html#a0057982066f25c66c20335bc159b6bf0">BumpHunter::getChi2Prob</a></div><div class="ttdeci">void getChi2Prob(double min_nll_null, double min_nll, double &amp;q0, double &amp;p_value)</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8cxx_source.html#l00619">BumpHunter.cxx:619</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_a0ae706a937df6c29e470ecb811930de5"><div class="ttname"><a href="classBumpHunter.html#a0ae706a937df6c29e470ecb811930de5">BumpHunter::bins_</a></div><div class="ttdeci">int bins_</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8h_source.html#l00292">BumpHunter.h:292</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_a0d2d8d320125ed3797d8566faf918c89"><div class="ttname"><a href="classBumpHunter.html#a0d2d8d320125ed3797d8566faf918c89">BumpHunter::bin_width_</a></div><div class="ttdeci">double bin_width_</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8h_source.html#l00295">BumpHunter.h:295</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_a2d4f31bb10de8afd6aef3d5db65c67d3"><div class="ttname"><a href="classBumpHunter.html#a2d4f31bb10de8afd6aef3d5db65c67d3">BumpHunter::toy_poly_order_</a></div><div class="ttdeci">int toy_poly_order_</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8h_source.html#l00301">BumpHunter.h:301</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_a31c941fca8bf7da62047b75da7aa6173"><div class="ttname"><a href="classBumpHunter.html#a31c941fca8bf7da62047b75da7aa6173">BumpHunter::printDebug</a></div><div class="ttdeci">void printDebug(std::string message)</div><div class="ttdoc">Print debug statement.</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8cxx_source.html#l00316">BumpHunter.cxx:316</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_a33613c572796670d8d23b2d14832ba01"><div class="ttname"><a href="classBumpHunter.html#a33613c572796670d8d23b2d14832ba01">BumpHunter::correctMass</a></div><div class="ttdeci">double correctMass(double mass)</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8cxx_source.html#l00640">BumpHunter.cxx:640</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_a3790858d9da7917e1e5690e8e25f7df1"><div class="ttname"><a href="classBumpHunter.html#a3790858d9da7917e1e5690e8e25f7df1">BumpHunter::window_end_</a></div><div class="ttdeci">double window_end_</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8h_source.html#l00323">BumpHunter.h:323</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_a3abd15b0e3c354499407a3543dd13a31"><div class="ttname"><a href="classBumpHunter.html#a3abd15b0e3c354499407a3543dd13a31">BumpHunter::mass_hypothesis_</a></div><div class="ttdeci">double mass_hypothesis_</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8h_source.html#l00326">BumpHunter.h:326</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_a3d28caaba9e4221b4fa810f329ffa73c"><div class="ttname"><a href="classBumpHunter.html#a3d28caaba9e4221b4fa810f329ffa73c">BumpHunter::calculatePValue</a></div><div class="ttdeci">void calculatePValue(HpsFitResult *result)</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8cxx_source.html#l00271">BumpHunter.cxx:271</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_a449e4ec04186381246a9c41514f16afb"><div class="ttname"><a href="classBumpHunter.html#a449e4ec04186381246a9c41514f16afb">BumpHunter::window_size_</a></div><div class="ttdeci">double window_size_</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8h_source.html#l00289">BumpHunter.h:289</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_a458fd9d0004cf6e713274816d870ad79"><div class="ttname"><a href="classBumpHunter.html#a458fd9d0004cf6e713274816d870ad79">BumpHunter::window_start_</a></div><div class="ttdeci">double window_start_</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8h_source.html#l00320">BumpHunter.h:320</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_a47101d046517bdb11968ac8c6435a741"><div class="ttname"><a href="classBumpHunter.html#a47101d046517bdb11968ac8c6435a741">BumpHunter::getUpperLimitPower</a></div><div class="ttdeci">void getUpperLimitPower(TH1 *histogram, HpsFitResult *result)</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8cxx_source.html#l00489">BumpHunter.cxx:489</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_a4cfe5da84bfe10b4135cb4ee6b1be2b5"><div class="ttname"><a href="classBumpHunter.html#a4cfe5da84bfe10b4135cb4ee6b1be2b5">BumpHunter::getUpperLimitAsymptotic</a></div><div class="ttdeci">void getUpperLimitAsymptotic(TH1 *histogram, HpsFitResult *result)</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8cxx_source.html#l00328">BumpHunter.cxx:328</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_a590f0aee7376661dd59c4ffa55299636"><div class="ttname"><a href="classBumpHunter.html#a590f0aee7376661dd59c4ffa55299636">BumpHunter::getUpperLimitAsymCLs</a></div><div class="ttdeci">void getUpperLimitAsymCLs(TH1 *histogram, HpsFitResult *result)</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8cxx_source.html#l00357">BumpHunter.cxx:357</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_a6049d3e75de41a68f8c1716f3be37139"><div class="ttname"><a href="classBumpHunter.html#a6049d3e75de41a68f8c1716f3be37139">BumpHunter::initialize</a></div><div class="ttdeci">void initialize(TH1 *histogram, double &amp;mass_hypothesis)</div><div class="ttdoc">Given the mass of interest, setup the window parameters and initialize the fit parameters.</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8cxx_source.html#l00025">BumpHunter.cxx:25</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_a6bd2e287952b5ae1739695702f163a2c"><div class="ttname"><a href="classBumpHunter.html#a6bd2e287952b5ae1739695702f163a2c">BumpHunter::getMassResolution</a></div><div class="ttdeci">double getMassResolution(double mass)</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8h_source.html#l00202">BumpHunter.h:202</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_a70c926bc5e1c24e91380e4c4f66a7648"><div class="ttname"><a href="classBumpHunter.html#a70c926bc5e1c24e91380e4c4f66a7648">BumpHunter::~BumpHunter</a></div><div class="ttdeci">~BumpHunter()</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8cxx_source.html#l00023">BumpHunter.cxx:23</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_a7bbdb311c63769e15635e1b97cc2dbb9"><div class="ttname"><a href="classBumpHunter.html#a7bbdb311c63769e15635e1b97cc2dbb9">BumpHunter::poly_order_</a></div><div class="ttdeci">int poly_order_</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8h_source.html#l00298">BumpHunter.h:298</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_aa31d0f96045ccea06ad2513c5b9cb625"><div class="ttname"><a href="classBumpHunter.html#aa31d0f96045ccea06ad2513c5b9cb625">BumpHunter::integral_</a></div><div class="ttdeci">double integral_</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8h_source.html#l00271">BumpHunter.h:271</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_ab8ef5199cc7df21b4170697aa872adf8"><div class="ttname"><a href="classBumpHunter.html#ab8ef5199cc7df21b4170697aa872adf8">BumpHunter::res_factor_</a></div><div class="ttdeci">double res_factor_</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8h_source.html#l00286">BumpHunter.h:286</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_ac334956f3e0c53dcaf9d71cc8ec5b523"><div class="ttname"><a href="classBumpHunter.html#ac334956f3e0c53dcaf9d71cc8ec5b523">BumpHunter::lower_bound_</a></div><div class="ttdeci">double lower_bound_</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8h_source.html#l00265">BumpHunter.h:265</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_ac69da25e77c53cd89082a3d2c1a9a3ac"><div class="ttname"><a href="classBumpHunter.html#ac69da25e77c53cd89082a3d2c1a9a3ac">BumpHunter::BumpHunter</a></div><div class="ttdeci">BumpHunter(FitFunction::BkgModel model, int poly_order, int toy_poly_order, int res_factor, double res_scale=1.00, bool asymptotic_limit=true)</div><div class="ttdoc">Default Constructor.</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8cxx_source.html#l00014">BumpHunter.cxx:14</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_acd40c1b855c9349b42b71fa452f71bae"><div class="ttname"><a href="classBumpHunter.html#acd40c1b855c9349b42b71fa452f71bae">BumpHunter::window_use_res_scale_</a></div><div class="ttdeci">bool window_use_res_scale_</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8h_source.html#l00332">BumpHunter.h:332</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_ad238d7648d7f332843b306a23231c5f0"><div class="ttname"><a href="classBumpHunter.html#ad238d7648d7f332843b306a23231c5f0">BumpHunter::upper_bound_</a></div><div class="ttdeci">double upper_bound_</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8h_source.html#l00268">BumpHunter.h:268</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_ad64f64aaf5e929622312e05211e4b1b6"><div class="ttname"><a href="classBumpHunter.html#ad64f64aaf5e929622312e05211e4b1b6">BumpHunter::bkg_model_</a></div><div class="ttdeci">FitFunction::BkgModel bkg_model_</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8h_source.html#l00274">BumpHunter.h:274</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_ad9ecd75afa199886f0a8bfed07bd4466"><div class="ttname"><a href="classBumpHunter.html#ad9ecd75afa199886f0a8bfed07bd4466">BumpHunter::setBounds</a></div><div class="ttdeci">void setBounds(double low_bound, double high_bound)</div><div class="ttdoc">Set the histogram bounds.</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8cxx_source.html#l00634">BumpHunter.cxx:634</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_aded2f9f6064603451dd5ee2087a4744b"><div class="ttname"><a href="classBumpHunter.html#aded2f9f6064603451dd5ee2087a4744b">BumpHunter::generateToys</a></div><div class="ttdeci">std::vector&lt; TH1 * &gt; generateToys(TH1 *histogram, double n_toys, int seed, int toy_sig_samples, int bkg_mult=1, TH1 *signal_hist=nullptr)</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8cxx_source.html#l00589">BumpHunter.cxx:589</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_ae5196e96a1d111b73a37c60050f9bef6"><div class="ttname"><a href="classBumpHunter.html#ae5196e96a1d111b73a37c60050f9bef6">BumpHunter::getUpperLimit</a></div><div class="ttdeci">void getUpperLimit(TH1 *histogram, HpsFitResult *result)</div><div class="ttdoc">Get the signal upper limit.</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8cxx_source.html#l00320">BumpHunter.cxx:320</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_aecfe482d49262352e9a22b2bfadf8df7"><div class="ttname"><a href="classBumpHunter.html#aecfe482d49262352e9a22b2bfadf8df7">BumpHunter::asymptotic_limit_</a></div><div class="ttdeci">bool asymptotic_limit_</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8h_source.html#l00280">BumpHunter.h:280</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_af3c76196a1177ca2e83af12c93a17ce4"><div class="ttname"><a href="classBumpHunter.html#af3c76196a1177ca2e83af12c93a17ce4">BumpHunter::performSearch</a></div><div class="ttdeci">HpsFitResult * performSearch(TH1 *histogram, double mass_hypothesis, bool skip_bkg_fit, bool skip_ul)</div><div class="ttdoc">Perform a search for a resonance at the given mass hypothesis.</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8cxx_source.html#l00108">BumpHunter.cxx:108</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_af69acc2708c03aaae1cd620ccb39c5b2"><div class="ttname"><a href="classBumpHunter.html#af69acc2708c03aaae1cd620ccb39c5b2">BumpHunter::mass_resolution_</a></div><div class="ttdeci">double mass_resolution_</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8h_source.html#l00329">BumpHunter.h:329</a></div></div>
<div class="ttc" id="aclassBumpHunter_html_afef2ebdae7761aca3363b0352d8bc143"><div class="ttname"><a href="classBumpHunter.html#afef2ebdae7761aca3363b0352d8bc143">BumpHunter::corr_mass_</a></div><div class="ttdeci">double corr_mass_</div><div class="ttdef"><b>Definition:</b> <a href="BumpHunter_8h_source.html#l00262">BumpHunter.h:262</a></div></div>
<div class="ttc" id="aclassChebyshevFitFunction_html"><div class="ttname"><a href="classChebyshevFitFunction.html">ChebyshevFitFunction</a></div><div class="ttdoc">description</div><div class="ttdef"><b>Definition:</b> <a href="ChebyshevFitFunction_8h_source.html#l00010">ChebyshevFitFunction.h:10</a></div></div>
<div class="ttc" id="aclassFitFunction_html_a48da86489d89d37c13ad9e7443afb4ec"><div class="ttname"><a href="classFitFunction.html#a48da86489d89d37c13ad9e7443afb4ec">FitFunction::ModelOrder</a></div><div class="ttdeci">ModelOrder</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition:</b> <a href="FitFunction_8h_source.html#l00028">FitFunction.h:28</a></div></div>
<div class="ttc" id="aclassFitFunction_html_a4be0c1a828439ca1afb1489b055636e6"><div class="ttname"><a href="classFitFunction.html#a4be0c1a828439ca1afb1489b055636e6">FitFunction::BkgModel</a></div><div class="ttdeci">BkgModel</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition:</b> <a href="FitFunction_8h_source.html#l00039">FitFunction.h:39</a></div></div>
<div class="ttc" id="aclassHpsFitResult_html"><div class="ttname"><a href="classHpsFitResult.html">HpsFitResult</a></div><div class="ttdoc">description</div><div class="ttdef"><b>Definition:</b> <a href="HpsFitResult_8h_source.html#l00015">HpsFitResult.h:15</a></div></div>
<div class="ttc" id="aclassHpsFitResult_html_a03216a940ea19c8f4f60c9407bb41e23"><div class="ttname"><a href="classHpsFitResult.html#a03216a940ea19c8f4f60c9407bb41e23">HpsFitResult::setCompFitResult</a></div><div class="ttdeci">void setCompFitResult(TFitResultPtr comp_result)</div><div class="ttdoc">Set the result from the signal+background only fit.</div><div class="ttdef"><b>Definition:</b> <a href="HpsFitResult_8h_source.html#l00201">HpsFitResult.h:201</a></div></div>
<div class="ttc" id="aclassHpsFitResult_html_a170955b89c0bf4ae1de1548bca6f6443"><div class="ttname"><a href="classHpsFitResult.html#a170955b89c0bf4ae1de1548bca6f6443">HpsFitResult::setIntegral</a></div><div class="ttdeci">void setIntegral(double integral)</div><div class="ttdoc">Set the integral.</div><div class="ttdef"><b>Definition:</b> <a href="HpsFitResult_8h_source.html#l00166">HpsFitResult.h:166</a></div></div>
<div class="ttc" id="aclassHpsFitResult_html_a1e62c1e3c4a18c09c0914aa6c0089e05"><div class="ttname"><a href="classHpsFitResult.html#a1e62c1e3c4a18c09c0914aa6c0089e05">HpsFitResult::getBkgFitResult</a></div><div class="ttdeci">TFitResultPtr getBkgFitResult()</div><div class="ttdoc">Get background fit result.</div><div class="ttdef"><b>Definition:</b> <a href="HpsFitResult_8h_source.html#l00029">HpsFitResult.h:29</a></div></div>
<div class="ttc" id="aclassHpsFitResult_html_a1f10cedd700440287d7ba0c30974a445"><div class="ttname"><a href="classHpsFitResult.html#a1f10cedd700440287d7ba0c30974a445">HpsFitResult::setBkgModelType</a></div><div class="ttdeci">void setBkgModelType(FitFunction::BkgModel bkg_model)</div><div class="ttdoc">Sets the type of background fit function used by the fitter.</div><div class="ttdef"><b>Definition:</b> <a href="HpsFitResult_8h_source.html#l00229">HpsFitResult.h:229</a></div></div>
<div class="ttc" id="aclassHpsFitResult_html_a20e865f8fb2cd8d7de6ba27bcc3de629"><div class="ttname"><a href="classHpsFitResult.html#a20e865f8fb2cd8d7de6ba27bcc3de629">HpsFitResult::setQ0</a></div><div class="ttdeci">void setQ0(double q0)</div><div class="ttdoc">Set Q0.</div><div class="ttdef"><b>Definition:</b> <a href="HpsFitResult_8h_source.html#l00173">HpsFitResult.h:173</a></div></div>
<div class="ttc" id="aclassHpsFitResult_html_a35254fb98290afbfbe18e79fbed925cf"><div class="ttname"><a href="classHpsFitResult.html#a35254fb98290afbfbe18e79fbed925cf">HpsFitResult::getCompFitResult</a></div><div class="ttdeci">TFitResultPtr getCompFitResult()</div><div class="ttdoc">Get the complete fit result.</div><div class="ttdef"><b>Definition:</b> <a href="HpsFitResult_8h_source.html#l00043">HpsFitResult.h:43</a></div></div>
<div class="ttc" id="aclassHpsFitResult_html_a7602e2d11496a6a75d8ab5fae15b88a6"><div class="ttname"><a href="classHpsFitResult.html#a7602e2d11496a6a75d8ab5fae15b88a6">HpsFitResult::setPolyOrder</a></div><div class="ttdeci">void setPolyOrder(int poly_order)</div><div class="ttdoc">Set the order polynomial used by the fitter.</div><div class="ttdef"><b>Definition:</b> <a href="HpsFitResult_8h_source.html#l00222">HpsFitResult.h:222</a></div></div>
<div class="ttc" id="aclassHpsFitResult_html_a8f4d95016e5f7fb7cc3274c2db9eef42"><div class="ttname"><a href="classHpsFitResult.html#a8f4d95016e5f7fb7cc3274c2db9eef42">HpsFitResult::setCorrectedMass</a></div><div class="ttdeci">void setCorrectedMass(double cmass)</div><div class="ttdoc">Set the corrected mass.</div><div class="ttdef"><b>Definition:</b> <a href="HpsFitResult_8h_source.html#l00215">HpsFitResult.h:215</a></div></div>
<div class="ttc" id="aclassHpsFitResult_html_aae9462e59fedc456ce82bb0de9f4204d"><div class="ttname"><a href="classHpsFitResult.html#aae9462e59fedc456ce82bb0de9f4204d">HpsFitResult::setPValue</a></div><div class="ttdeci">void setPValue(double p_value)</div><div class="ttdoc">Set the p-value.</div><div class="ttdef"><b>Definition:</b> <a href="HpsFitResult_8h_source.html#l00180">HpsFitResult.h:180</a></div></div>
<div class="ttc" id="aclassHpsFitResult_html_aaeda11bbf86fb26fa75aeccd0951e78f"><div class="ttname"><a href="classHpsFitResult.html#aaeda11bbf86fb26fa75aeccd0951e78f">HpsFitResult::setMass</a></div><div class="ttdeci">void setMass(double mass)</div><div class="ttdoc">Set mass hypothesis used for this fit.</div><div class="ttdef"><b>Definition:</b> <a href="HpsFitResult_8h_source.html#l00208">HpsFitResult.h:208</a></div></div>
<div class="ttc" id="aclassHpsFitResult_html_aaf58002e96a9a78d0932a0f2d1ecc486"><div class="ttname"><a href="classHpsFitResult.html#aaf58002e96a9a78d0932a0f2d1ecc486">HpsFitResult::setBkgToysFitResult</a></div><div class="ttdeci">void setBkgToysFitResult(TFitResultPtr bkg_toy_result)</div><div class="ttdoc">Set the result from the background only fit for generating toys.</div><div class="ttdef"><b>Definition:</b> <a href="HpsFitResult_8h_source.html#l00194">HpsFitResult.h:194</a></div></div>
<div class="ttc" id="aclassHpsFitResult_html_aca22f27f6f5e945edb5afb016f5dde05"><div class="ttname"><a href="classHpsFitResult.html#aca22f27f6f5e945edb5afb016f5dde05">HpsFitResult::setUpperLimit</a></div><div class="ttdeci">void setUpperLimit(double upper_limit)</div><div class="ttdoc">Set the 2 sigma upper limit.</div><div class="ttdef"><b>Definition:</b> <a href="HpsFitResult_8h_source.html#l00236">HpsFitResult.h:236</a></div></div>
<div class="ttc" id="aclassHpsFitResult_html_ad3a7405505e0107be3e770cde19052ff"><div class="ttname"><a href="classHpsFitResult.html#ad3a7405505e0107be3e770cde19052ff">HpsFitResult::setBkgFitResult</a></div><div class="ttdeci">void setBkgFitResult(TFitResultPtr bkg_result)</div><div class="ttdoc">Set the result from the background only fit.</div><div class="ttdef"><b>Definition:</b> <a href="HpsFitResult_8h_source.html#l00187">HpsFitResult.h:187</a></div></div>
<div class="ttc" id="aclassHpsFitResult_html_aebdfc27cc0ab451a91d8708c93ed3f97"><div class="ttname"><a href="classHpsFitResult.html#aebdfc27cc0ab451a91d8708c93ed3f97">HpsFitResult::setUpperLimitPValue</a></div><div class="ttdeci">void setUpperLimitPValue(double upper_limit_p_value)</div><div class="ttdoc">Set the p-value at the end of the upper limit calculation.</div><div class="ttdef"><b>Definition:</b> <a href="HpsFitResult_8h_source.html#l00243">HpsFitResult.h:243</a></div></div>
<div class="ttc" id="aclassHpsFitResult_html_aed5f1bf530a1afa3c95da94063350554"><div class="ttname"><a href="classHpsFitResult.html#aed5f1bf530a1afa3c95da94063350554">HpsFitResult::getBkgToysFitResult</a></div><div class="ttdeci">TFitResultPtr getBkgToysFitResult()</div><div class="ttdoc">Get background toy model fit result.</div><div class="ttdef"><b>Definition:</b> <a href="HpsFitResult_8h_source.html#l00036">HpsFitResult.h:36</a></div></div>
<div class="ttc" id="aclassHpsFitResult_html_afa5c41c8e78f4a2d498c4e8f11f341c4"><div class="ttname"><a href="classHpsFitResult.html#afa5c41c8e78f4a2d498c4e8f11f341c4">HpsFitResult::setWindowSize</a></div><div class="ttdeci">void setWindowSize(double window_size)</div><div class="ttdoc">Set the size of the fit window used to get this results.</div><div class="ttdef"><b>Definition:</b> <a href="HpsFitResult_8h_source.html#l00250">HpsFitResult.h:250</a></div></div>
<div class="ttc" id="aclassLegendreFitFunction_html"><div class="ttname"><a href="classLegendreFitFunction.html">LegendreFitFunction</a></div><div class="ttdoc">description</div><div class="ttdef"><b>Definition:</b> <a href="LegendreFitFunction_8h_source.html#l00011">LegendreFitFunction.h:11</a></div></div>
<div class="ttc" id="anamespaceconfig_1_1anaKalSimpTuple__cfg_html_a61569f2965b7a369eb10b6d75d410d11"><div class="ttname"><a href="namespaceconfig_1_1anaKalSimpTuple__cfg.html#a61569f2965b7a369eb10b6d75d410d11">config.anaKalSimpTuple_cfg.int</a></div><div class="ttdeci">int</div><div class="ttdef"><b>Definition:</b> <a href="anaKalSimpTuple__cfg_8py_source.html#l00008">anaKalSimpTuple_cfg.py:8</a></div></div>
<div class="ttc" id="anamespaceconfig_1_1bhResSystematics__cfg_html_a448bf676d9cec8beea7ec942b1bda665"><div class="ttname"><a href="namespaceconfig_1_1bhResSystematics__cfg.html#a448bf676d9cec8beea7ec942b1bda665">config.bhResSystematics_cfg.poly_order</a></div><div class="ttdeci">poly_order</div><div class="ttdef"><b>Definition:</b> <a href="bhResSystematics__cfg_8py_source.html#l00036">bhResSystematics_cfg.py:36</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
