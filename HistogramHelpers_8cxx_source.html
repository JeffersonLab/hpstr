<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>hpstr: analysis/src/HistogramHelpers.cxx Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">hpstr
   </div>
   <div id="projectbrief">The Heavy Photon Search Toolkit for Reconstruction (hpstr) provides an interface to physics data from the HPS experiment saved in the LCIO format and converts it into an ROOT based format.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function() { init_codefold(0); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_b8678fa8510b7ff9a55ffd4d18fd5e47.html">analysis</a></li><li class="navelem"><a class="el" href="dir_bc66cf0f7bc2a011134b03d878d297c1.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">HistogramHelpers.cxx</div></div>
</div><!--header-->
<div class="contents">
<a href="HistogramHelpers_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">//Authors: F.Sforza, PF, Alignment Team</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span> </div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="preprocessor">#include &quot;<a class="code" href="HistogramHelpers_8h.html">HistogramHelpers.h</a>&quot;</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="preprocessor">#include &quot;TMath.h&quot;</span> </div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span> </div>
<div class="foldopen" id="foldopen00006" data-start="{" data-end="}">
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno"><a class="line" href="namespaceHistogramHelpers.html#af5e7ea391529a3ec63decc5523bcd34a">    6</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="namespaceHistogramHelpers.html#af5e7ea391529a3ec63decc5523bcd34a">HistogramHelpers::GaussExpTails_f</a>(<span class="keywordtype">double</span>* x, <span class="keywordtype">double</span> *par) {</div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span>  <span class="comment">//core Gaussian with exponential tails starting K</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> norm    = par[0];</div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> fracT   = par[1];</div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span>  <span class="comment">//const double fracTL   = par[1];</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span>  <span class="comment">//const double fracTH   = par[2];</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> meanG    = par[2];</div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> sigmaG   = par[3];</div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> K        = par[4];</div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span>  <span class="comment">//const double KL      = par[5];</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span>  <span class="comment">//const double KH      = par[6];</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span>  </div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span> </div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> GFact = TMath::Sqrt(2*TMath::Pi());</div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> GausExpNorm =  (GFact*sigmaG) *</div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span>    ( TMath::Erf( 0.70710678*K ) + exp( -K*K/2 ) * sqrt( 2/TMath::Pi() )/K);</div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span>  </div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span>  <span class="comment">//const double GausExpNormL =  (GFact*sigmaG) *</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span>  <span class="comment">//( TMath::Erf( 0.70710678*KL ) + exp( -KL*KL/2 ) * sqrt( 2/TMath::Pi() )/KL);</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span>  </div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span>  <span class="comment">//const double GausExpNormH =  (GFact*sigmaG) *</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span>  <span class="comment">//( TMath::Erf( 0.70710678*KH ) + exp( -KH*KH/2 ) * sqrt( 2/TMath::Pi() )/KH);</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>  </div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span>  <span class="comment">//return norm*fracT/GausExpNorm*exp( -K *fabs(x[0]-meanG)/sigmaG + K*K/2) +</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span>  <span class="comment">//norm*(1-fracT)/(GFact*sigmaG)*exp(-pow( (x[0]-meanG),2)/(2*pow(sigmaG,2)));</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span>  </div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>  <span class="comment">//if(fabs(x[0]-meanG)&gt; sigmaG*K) {</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>  <span class="keywordflow">return</span> norm*fracT/GausExpNorm*exp( -K *fabs(x[0]-meanG)/sigmaG + K*K/2) +</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>    norm*(1-fracT)/(GFact*sigmaG)*exp(-pow( (x[0]-meanG),2)/(2*pow(sigmaG,2)));</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>    <span class="comment">//} </span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>    <span class="comment">// return norm/(GFact*sigmaG)*exp(-pow( (x[0]-meanG),2)/(2*pow(sigmaG,2)));</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span> </div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>    </div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>  </div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>}</div>
</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span> </div>
<div class="foldopen" id="foldopen00042" data-start="{" data-end="}">
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno"><a class="line" href="namespaceHistogramHelpers.html#a79cb627357d524afbace2610d218ff94">   42</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="namespaceHistogramHelpers.html#a79cb627357d524afbace2610d218ff94">HistogramHelpers::twoGaussExp_f</a>(<span class="keywordtype">double</span> *x, <span class="keywordtype">double</span> *par){</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>  <span class="comment">//2 core Gaussian with exponential tails starting  K</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> norm = par[0];</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> fracT = par[1];</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> meanG = par[2];</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> sigmaGT = par[3];</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> sigmaGC = par[4]; </div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> K = par[5];</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>  </div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> GFact = TMath::Sqrt(2*TMath::Pi());</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> GausExpNorm =  (GFact*sigmaGT) *</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>    ( TMath::Erf( 0.70710678*K ) + exp( -K*K/2 ) * sqrt( 2/TMath::Pi() )/K);</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>  </div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>  <span class="keywordflow">if</span>(fabs(x[0]-meanG)&gt; sigmaGT*K) {</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>    <span class="keywordflow">return</span> norm*fracT/GausExpNorm*exp( -K *fabs(x[0]-meanG)/sigmaGT + K*K/2) +</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>      norm*(1-fracT)/(GFact*sigmaGC)*exp(-pow( (x[0]-meanG),2)/(2*pow(sigmaGC,2)));</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>  } </div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>  <span class="keywordflow">return</span> norm*fracT/GausExpNorm*exp(-pow( (x[0]-meanG), 2)/(2*pow(sigmaGT,2))) +</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>    norm*(1-fracT)/(GFact*sigmaGC)*exp(-pow( (x[0]-meanG),2)/(2*pow(sigmaGC,2)));</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>}</div>
</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span> </div>
<div class="foldopen" id="foldopen00063" data-start="{" data-end="}">
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno"><a class="line" href="namespaceHistogramHelpers.html#a5a70ca52b4c9a41f1bd3a7c4446edb9f">   63</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="namespaceHistogramHelpers.html#a5a70ca52b4c9a41f1bd3a7c4446edb9f">HistogramHelpers::twoGauss_f</a>(<span class="keywordtype">double</span> *x, <span class="keywordtype">double</span> *par){</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>  <span class="comment">//two Gaussians, Tail and Core, normalized to a total integral par[0] and of tail fraction par[1]</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> norm = par[0];</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> fracT = par[1];</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> meanG = par[2];</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> sigmaGT = par[3];</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> sigmaGC = par[4];</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> GFact = TMath::Sqrt(2*TMath::Pi());</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>  <span class="keywordflow">return</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>    norm*(1-fracT)/(GFact*sigmaGC)*exp(-pow( (x[0]-meanG),2)/(2*pow(sigmaGC,2))) +</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>    norm*fracT/(GFact*sigmaGT)*exp(-pow( (x[0]-meanG), 2)/(2*pow(sigmaGT,2)));</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>}</div>
</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span> </div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>  </div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span><span class="comment">//-------------------------------------------------------------</span></div>
<div class="foldopen" id="foldopen00078" data-start="{" data-end="}">
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno"><a class="line" href="namespaceHistogramHelpers.html#ae255e3c553d1f6fc52871f614713b342">   78</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="namespaceHistogramHelpers.html#ae255e3c553d1f6fc52871f614713b342">HistogramHelpers::profileZwithIterativeGaussFit</a>(TH3* hist, TH2* mu_graph, TH2* sigma_graph, <span class="keywordtype">int</span> num_bins, TH2* mu_err_graph, TH2* sigma_err_graph)</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>{</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>  <span class="keywordflow">if</span> (!hist) {</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>    cout&lt;&lt; <span class="stringliteral">&quot;ProfileZwithIterativeGaussFit(): No histogram supplied!&quot;</span>&lt;&lt;endl;</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>  }</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span> </div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>  </div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>  <span class="keywordtype">int</span> num_bins_x = hist-&gt;GetXaxis()-&gt;GetNbins();</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>  <span class="keywordtype">int</span> num_bins_y = hist-&gt;GetYaxis()-&gt;GetNbins();</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>        </div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span> </div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>  <span class="keywordtype">int</span> minEntries = 50;</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>  <span class="keywordtype">int</span> fDebug = 0;</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span> </div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>  </div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>  <span class="keywordtype">double</span> num_not_converged = 0;</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>  <span class="keywordtype">int</span> num_skipped = 0;</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span> </div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>  <span class="keywordtype">double</span> max_sigma = 0;</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>  <span class="keywordtype">double</span> min_sigma = 0;</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span> </div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>  <span class="keywordtype">double</span> max_mu = 0;</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>  <span class="keywordtype">double</span> min_mu = 0;</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span> </div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>  TH1D* current_proj;</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>  <span class="keywordflow">if</span> (fDebug || <span class="keyword">false</span>) std::cout &lt;&lt; <span class="stringliteral">&quot; ** profileZwithIterativeGaussFit ** target: &quot;</span> &lt;&lt; mu_graph-&gt;GetName() &lt;&lt; <span class="stringliteral">&quot; ** &quot;</span> &lt;&lt; std::endl; </div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span> </div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; num_bins_x+(num_bins==1); i+=num_bins) {</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span> </div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; num_bins_y+(num_bins==1); j+=num_bins) {</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>      </div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>      <span class="keywordtype">int</span> index = i/num_bins;</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>      <span class="keywordtype">int</span> index_y = j/num_bins;</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span> </div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>      current_proj = hist-&gt;ProjectionZ(Form(<span class="stringliteral">&quot;%s_GaussProjection_%i_%i&quot;</span>,hist-&gt;GetName(),index, index_y),i,i+num_bins-1,j,j+num_bins-1);</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>      current_proj-&gt;SetTitle(Form(<span class="stringliteral">&quot;%s - Bin %i x %i&quot;</span>,hist-&gt;GetName(), index,index_y));</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span> </div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>      <span class="keywordtype">double</span> current_mu,current_err_mu, current_sigma, current_err_sigma;</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span> </div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>      <span class="keywordflow">if</span>(current_proj-&gt;GetEntries() &lt; minEntries) {</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>    <span class="comment">//if (m_PrintLevel &gt;= 3) cout &lt;&lt; &quot; ** profileZwithIterativeGaussFit ** fitting &quot; &lt;&lt; hist-&gt;GetName() &lt;&lt; &quot;  bin (&quot; &lt;&lt; index &lt;&lt; &quot;, &quot; &lt;&lt; index_y &lt;&lt; &quot;) &quot;</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>    <span class="comment">//              &lt;&lt; &quot; Not enough entries &quot; &lt;&lt; current_proj-&gt;GetEntries() &lt;&lt; &quot; &lt; &quot; &lt;&lt; minEntries &lt;&lt; endl;</span></div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>    <span class="comment">//current_mu = -999;</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>    current_mu = 0;</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>    current_sigma = 0;</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>    current_err_mu = 1;</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    current_err_sigma = 1;</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>    </div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>    <span class="keywordflow">if</span> (fDebug) std::cout&lt;&lt;<span class="stringliteral">&quot;WARNING: Only &quot;</span>&lt;&lt;current_proj-&gt;GetEntries()&lt;&lt;<span class="stringliteral">&quot; entries in bin &quot;</span>&lt;&lt;index&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;index_y&lt;&lt; <span class="stringliteral">&quot; in histogram &quot;</span> &lt;&lt;hist-&gt;GetName()&lt;&lt; std::endl;</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>    num_skipped++;</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span> </div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>      } </div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>      <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>    <span class="comment">//if (m_PrintLevel &gt;= 3) cout &lt;&lt; &quot; ** profileZwithIterativeGaussFit ** fitting &quot; &lt;&lt; hist-&gt;GetName() </span></div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>    <span class="comment">//              &lt;&lt; &quot;  bin (&quot; &lt;&lt; index &lt;&lt; &quot;, &quot; &lt;&lt; index_y &lt;&lt; &quot;) &quot;</span></div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>    <span class="comment">//              &lt;&lt; &quot;  entries: &quot;&lt;&lt; current_proj-&gt;GetEntries()</span></div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>    <span class="comment">//              &lt;&lt; endl;</span></div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    </div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>    <a class="code hl_function" href="namespaceHistogramHelpers.html#a48b5e0e009cea204405075d35452b4a9">IterativeGaussFit</a>(current_proj, current_mu, current_err_mu, current_sigma, current_err_sigma);</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>    </div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    <span class="keywordflow">if</span> (current_sigma &gt; max_sigma || max_sigma == 0) max_sigma = current_sigma;</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>    <span class="keywordflow">if</span> (current_sigma &lt; min_sigma || min_sigma == 0) min_sigma = current_sigma;</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>    <span class="keywordflow">if</span> (current_mu &gt; max_mu || max_mu == 0) max_mu = current_mu;</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    <span class="keywordflow">if</span> (current_mu &lt; min_mu || min_mu == 0) min_mu = current_mu;</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>    </div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>      }<span class="comment">//end if entries &lt; minEntries</span></div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>      </div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>      <span class="keywordtype">float</span> x_coord = (hist-&gt;GetXaxis()-&gt;GetBinLowEdge(i) + hist-&gt;GetXaxis()-&gt;GetBinUpEdge(i+num_bins-1))/2;</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>      <span class="keywordtype">float</span> y_coord = (hist-&gt;GetYaxis()-&gt;GetBinLowEdge(j) + hist-&gt;GetYaxis()-&gt;GetBinUpEdge(j+num_bins-1))/2;</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>      </div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>      <span class="keywordtype">int</span> binx = mu_graph-&gt;GetXaxis()-&gt;FindBin(x_coord);</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>      <span class="keywordtype">int</span> biny = mu_graph-&gt;GetYaxis()-&gt;FindBin(y_coord);</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>      <span class="keywordflow">if</span> (mu_graph) {</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    mu_graph-&gt;Fill(x_coord,y_coord,current_mu);</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>    mu_graph-&gt;SetBinError(binx,biny, current_err_mu);</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>    <span class="keywordflow">if</span> (fDebug || <span class="keyword">false</span>) std::cout &lt;&lt; <span class="stringliteral">&quot; ** profileZwithIterativeGaussFit ** target: &quot;</span> &lt;&lt; mu_graph-&gt;GetName()</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>                       &lt;&lt; <span class="stringliteral">&quot; bin(&quot;</span> &lt;&lt; binx &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; biny &lt;&lt; <span class="stringliteral">&quot;) = &quot;</span> &lt;&lt; current_mu</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>                       &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; current_err_mu &lt;&lt; std::endl;</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>      }</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>      <span class="comment">//should probably be replace bin content, not fill?</span></div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>      <span class="keywordflow">if</span> (sigma_graph)         sigma_graph-&gt;SetBinContent(binx, biny, current_sigma);</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>      <span class="keywordflow">if</span> (sigma_err_graph) sigma_err_graph-&gt;SetBinContent(binx, biny, current_err_sigma);</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>      <span class="keywordflow">if</span> (mu_err_graph)       mu_err_graph-&gt;SetBinContent(binx, biny,current_err_mu);</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>      </div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>      <span class="keyword">delete</span> current_proj;</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>      </div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>    } <span class="comment">//end loop on j (y)</span></div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>  } <span class="comment">//end loop on i (x)</span></div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>  </div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>  <span class="keywordflow">if</span> (mu_graph) {</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>    mu_graph-&gt;GetXaxis()-&gt;SetTitle(hist-&gt;GetXaxis()-&gt;GetTitle());</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>    mu_graph-&gt;GetYaxis()-&gt;SetTitle(hist-&gt;GetYaxis()-&gt;GetTitle());</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    mu_graph-&gt;GetYaxis()-&gt;SetTitleOffset(1);</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>    mu_graph-&gt;GetZaxis()-&gt;SetTitle(hist-&gt;GetZaxis()-&gt;GetTitle());</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>    mu_graph-&gt;GetZaxis()-&gt;SetTitleOffset(1.2);</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>    mu_graph-&gt;SetTitle(hist-&gt;GetTitle() );</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>    <span class="comment">//mu_graph-&gt;SetMaximum(max_mu + 0.1* (max_mu-min_mu));</span></div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>    <span class="comment">//mu_graph-&gt;SetMinimum(min_mu - 0.1* (max_mu-min_mu));</span></div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>  }</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>  </div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>  <span class="keywordflow">if</span> (sigma_graph) {</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>    sigma_graph-&gt;GetXaxis()-&gt;SetTitle(hist-&gt;GetXaxis()-&gt;GetTitle());</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>    sigma_graph-&gt;GetYaxis()-&gt;SetTitle(hist-&gt;GetYaxis()-&gt;GetTitle());</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>    sigma_graph-&gt;GetYaxis()-&gt;SetTitleOffset(1);</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>    sigma_graph-&gt;GetZaxis()-&gt;SetTitle(hist-&gt;GetZaxis()-&gt;GetTitle());</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>    sigma_graph-&gt;GetZaxis()-&gt;SetTitleOffset(1.2);</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>    sigma_graph-&gt;SetTitle( hist-&gt;GetTitle() );</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>    <span class="comment">//sigma_graph-&gt;SetMaximum(max_sigma + 0.1* (max_sigma-min_sigma));</span></div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>    <span class="comment">//sigma_graph-&gt;SetMinimum(min_sigma - 0.1* (max_sigma-min_sigma));</span></div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>  }</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>  </div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>  <span class="keywordflow">if</span> (mu_err_graph) {</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>    mu_err_graph-&gt;GetXaxis()-&gt;SetTitle(hist-&gt;GetXaxis()-&gt;GetTitle());</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>    mu_err_graph-&gt;GetYaxis()-&gt;SetTitle(hist-&gt;GetYaxis()-&gt;GetTitle());</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>    mu_err_graph-&gt;GetYaxis()-&gt;SetTitleOffset(1);</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>    mu_err_graph-&gt;GetZaxis()-&gt;SetTitle(Form(<span class="stringliteral">&quot;Error of fit #mu: %s&quot;</span>,hist-&gt;GetZaxis()-&gt;GetTitle()));</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>    mu_err_graph-&gt;GetZaxis()-&gt;SetTitleOffset(1.2);</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>    mu_err_graph-&gt;SetTitle(hist-&gt;GetTitle());</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>    <span class="comment">//mu_err_graph-&gt;SetMaximum(max_mu + 0.1* (max_mu-min_mu));</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>    <span class="comment">//mu_err_graph-&gt;SetMinimum(min_mu - 0.1* (max_mu-min_mu));</span></div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>  }</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>  </div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>  <span class="keywordflow">if</span> (sigma_err_graph) {</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>    sigma_err_graph-&gt;GetXaxis()-&gt;SetTitle(hist-&gt;GetXaxis()-&gt;GetTitle());</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>    sigma_err_graph-&gt;GetYaxis()-&gt;SetTitle(hist-&gt;GetYaxis()-&gt;GetTitle());</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>    sigma_err_graph-&gt;GetYaxis()-&gt;SetTitleOffset(1);</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>    sigma_err_graph-&gt;GetZaxis()-&gt;SetTitle(Form(<span class="stringliteral">&quot;Error of fit #sigma: %s&quot;</span>,hist-&gt;GetZaxis()-&gt;GetTitle()));</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>    sigma_err_graph-&gt;GetZaxis()-&gt;SetTitleOffset(1.2);</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    sigma_err_graph-&gt;SetTitle(hist-&gt;GetTitle());</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>    <span class="comment">//sigma_err_graph-&gt;SetMaximum(max_mu + 0.1* (max_mu-min_mu));</span></div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>    <span class="comment">//sigma_err_graph-&gt;SetMinimum(min_mu - 0.1* (max_mu-min_mu));</span></div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>  }</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>  </div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>  </div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>  <span class="keywordflow">if</span> (num_not_converged || num_skipped) std::cout&lt;&lt;<span class="stringliteral">&quot;Fit Results for histogram: &quot;</span>&lt;&lt; hist-&gt;GetName()&lt;&lt;std::endl;</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>  <span class="keywordflow">if</span> (num_not_converged) std::cout&lt;&lt;<span class="stringliteral">&quot;Non Convergent Bin Fraction: &quot;</span>&lt;&lt;num_not_converged&lt;&lt; <span class="stringliteral">&quot; / &quot;</span> &lt;&lt;num_bins_x*num_bins_y - num_skipped&lt;&lt;std::endl;</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>  <span class="keywordflow">if</span> (num_skipped) std::cout&lt;&lt;<span class="stringliteral">&quot;Number skipped bins: &quot;</span>&lt;&lt;num_skipped&lt;&lt; <span class="stringliteral">&quot; / &quot;</span> &lt;&lt;num_bins_x*num_bins_y&lt;&lt;std::endl;</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>  </div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>  <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>}</div>
</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span> </div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span> </div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span> </div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span> </div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span> </div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span><span class="comment">//-----------------------------------------------------------------------------</span></div>
<div class="foldopen" id="foldopen00225" data-start="{" data-end="}">
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno"><a class="line" href="namespaceHistogramHelpers.html#a0bc0b4eb1d4612a7d4cc9f681eb86deb">  225</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="namespaceHistogramHelpers.html#a0bc0b4eb1d4612a7d4cc9f681eb86deb">HistogramHelpers::profileYwithIterativeGaussFit</a>(TH2* hist, TH1* mu_graph, TH1* sigma_graph, <span class="keywordtype">int</span> num_bins,<span class="keywordtype">int</span> m_PrintLevel)</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>{</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>  </div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>  <span class="keywordflow">if</span> (!hist) {</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>    std::cout &lt;&lt; <span class="stringliteral">&quot;Error in ProfileYwithIterativeGaussFit(): Histogram not found&quot;</span> &lt;&lt;std::endl;</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>  }</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>  </div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>  <span class="keywordflow">if</span> (num_bins &lt; 1 ) {</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>    std::cout &lt;&lt; <span class="stringliteral">&quot;Error in ProfileYwithIterativeGaussFit(): Invalid number of bins to integrate over.&quot;</span> &lt;&lt;std::endl;</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>  }</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span> </div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> minEntries = 50;</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> fDebug = 0;</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span> </div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>  <span class="keywordtype">int</span> num_bins_x = hist-&gt;GetXaxis()-&gt;GetNbins();</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span> </div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>  <span class="keywordflow">if</span> (mu_graph) mu_graph-&gt;Rebin(num_bins);</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>  <span class="keywordflow">if</span> (sigma_graph) sigma_graph-&gt;Rebin(num_bins);</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span> </div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>  <span class="keywordtype">double</span>* errs_mu = <span class="keyword">new</span> <span class="keywordtype">double</span>[num_bins_x/num_bins + 2]; <span class="comment">// +2 for overflow!!</span></div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>  <span class="keywordtype">double</span>* errs_sigma = <span class="keyword">new</span> <span class="keywordtype">double</span>[num_bins_x/num_bins + 2];</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span> </div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>  errs_mu[0] = 0;</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>  errs_mu[num_bins_x/num_bins + 1] = 0;</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span> </div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>  errs_sigma[0] = 0;</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>  errs_sigma[num_bins_x/num_bins + 1] = 0;</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span> </div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>  <span class="keywordtype">double</span> min_sigma = 0;</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>  <span class="keywordtype">double</span> max_sigma = 0;</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>  <span class="keywordtype">double</span> min_mu = 0;</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>  <span class="keywordtype">double</span> max_mu = 0;</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span> </div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>  <span class="keywordtype">int</span> num_skipped = 0;</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span> </div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>  TH1D* current_proj;</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span> </div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; (num_bins_x + (num_bins == 1)); i+=num_bins) {</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span> </div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>    <span class="keywordtype">int</span> index = i/num_bins;</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>    <span class="keywordflow">if</span> (num_bins == 1) index--;</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span> </div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>    current_proj = hist-&gt;ProjectionY(Form(<span class="stringliteral">&quot;%s_projection_%i&quot;</span>,hist-&gt;GetName(),index),i,i+num_bins-1);</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span> </div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>    <span class="keywordtype">double</span> mu, mu_err, sigma, sigma_err;</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span> </div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>    <span class="keywordflow">if</span>(current_proj-&gt;GetEntries() &lt; minEntries) {</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>      mu = 0;</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>      mu_err = 0;</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>      sigma = 0;</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>      sigma_err = 0;</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>      num_skipped++;</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>      <span class="keywordflow">if</span> ( fDebug ) std::cout&lt;&lt;<span class="stringliteral">&quot;WARNING: Not enough entries in bin &quot;</span>&lt;&lt;index&lt;&lt;std::endl;</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span> </div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>      <a class="code hl_function" href="namespaceHistogramHelpers.html#a48b5e0e009cea204405075d35452b4a9">IterativeGaussFit</a>(current_proj, mu, mu_err, sigma, sigma_err,m_PrintLevel);</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span> </div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>      <span class="keywordflow">if</span> (sigma &gt; max_sigma || max_sigma == 0) max_sigma = sigma;</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>      <span class="keywordflow">if</span> (sigma &lt; min_sigma || min_sigma == 0) min_sigma = sigma;</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>      <span class="keywordflow">if</span> (mu &gt; max_mu || max_mu == 0) max_mu = mu;</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>      <span class="keywordflow">if</span> (mu &lt; min_mu || min_mu == 0) min_mu = mu;</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span> </div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>    }</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span> </div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>    <span class="keywordtype">double</span> value_x = (hist-&gt;GetXaxis()-&gt;GetBinLowEdge(i) + hist-&gt;GetXaxis()-&gt;GetBinUpEdge(i+num_bins-1))/2;</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span> </div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>    <span class="comment">//Important!! Use Fill to increment the graph with each iteration, or SetBinContent to replace contents...</span></div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span> </div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>    <span class="keywordflow">if</span> (sigma_graph) sigma_graph-&gt;Fill(value_x, sigma);</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>    <span class="keywordflow">if</span> (mu_graph) mu_graph-&gt;Fill(value_x, mu);</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>        </div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>    errs_mu[index + 1] = mu_err;</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>    errs_sigma[index + 1] = sigma_err;</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>    </div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>    <span class="comment">/*</span></div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span><span class="comment">    std::cout&lt;&lt;hist-&gt;GetName()&lt;&lt;&quot; &quot;&lt;&lt;index+1&lt;&lt;&quot;  mu = &quot; &lt;&lt;mu&lt;&lt;&quot;+/-&quot;&lt;&lt;mu_err&lt;&lt;std::endl;</span></div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span><span class="comment">    std::cout&lt;&lt;hist-&gt;GetName()&lt;&lt;&quot; &quot;&lt;&lt;index+1&lt;&lt;&quot;  sigma = &quot; &lt;&lt;sigma&lt;&lt;&quot;+/-&quot;&lt;&lt;sigma_err&lt;&lt;std::endl;</span></div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span><span class="comment">    */</span></div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span> </div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>    <span class="keyword">delete</span> current_proj;</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>  }</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span> </div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>  <span class="keywordflow">if</span> (sigma_graph) {</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>     sigma_graph-&gt;SetError(errs_sigma);</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>    <span class="comment">//sigma_graph-&gt;SetMaximum(max_sigma+0.15*(max_sigma - min_sigma));</span></div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>    <span class="comment">//sigma_graph-&gt;SetMinimum(min_sigma-0.15*(max_sigma - min_sigma));</span></div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>    sigma_graph-&gt;GetYaxis()-&gt;SetTitleOffset(1.5);</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>    <span class="comment">//sigma_graph-&gt;GetYaxis()-&gt;SetTitle(hist-&gt;GetYaxis()-&gt;GetTitle());</span></div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>    <span class="comment">//sigma_graph-&gt;GetXaxis()-&gt;SetTitle(hist-&gt;GetXaxis()-&gt;GetTitle());</span></div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>    sigma_graph-&gt;GetYaxis()-&gt;SetTitle(sigma_graph-&gt;GetYaxis()-&gt;GetTitle());</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>    sigma_graph-&gt;GetXaxis()-&gt;SetTitle(sigma_graph-&gt;GetXaxis()-&gt;GetTitle());</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>    sigma_graph-&gt;SetTitle(<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>  }</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span> </div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>  <span class="keywordflow">if</span> (mu_graph) {</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>      mu_graph-&gt;SetError(errs_mu);</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>    <span class="comment">//mu_graph-&gt;SetMaximum(max_mu+0.15*(max_mu - min_mu));</span></div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>    <span class="comment">//mu_graph-&gt;SetMinimum(min_mu-0.15*(max_mu - min_mu));</span></div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>    mu_graph-&gt;GetYaxis()-&gt;SetTitleOffset(1.5);</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>    <span class="comment">//    mu_graph-&gt;GetYaxis()-&gt;SetTitle(hist-&gt;GetYaxis()-&gt;GetTitle());</span></div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>    <span class="comment">// mu_graph-&gt;GetXaxis()-&gt;SetTitle(hist-&gt;GetXaxis()-&gt;GetTitle());</span></div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>    mu_graph-&gt;GetYaxis()-&gt;SetTitle(mu_graph-&gt;GetYaxis()-&gt;GetTitle());</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>    mu_graph-&gt;GetXaxis()-&gt;SetTitle(mu_graph-&gt;GetXaxis()-&gt;GetTitle());</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>    mu_graph-&gt;SetTitle(<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>  }</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span> </div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>  <span class="keywordflow">if</span> (fDebug &amp;&amp; num_skipped)  std::cout&lt;&lt;<span class="stringliteral">&quot; Number of skipped bins: &quot;</span>&lt;&lt;num_skipped&lt;&lt;std::endl;</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span> </div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>  <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>  </div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>}</div>
</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span> </div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span> </div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span><span class="comment">//@par1 histogram to fit</span></div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span><span class="comment">//@par2 pointer to function (which needs to be defined as double fcn(double*,double*)</span></div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span><span class="comment">//@par3 initialParams</span></div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span><span class="comment">//@par4 fitRange</span></div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span><span class="comment">//@par5 FitResultPtr</span></div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span><span class="comment">//@return Pointer to the fit function</span></div>
<div class="foldopen" id="foldopen00346" data-start="{" data-end="}">
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno"><a class="line" href="namespaceHistogramHelpers.html#a430d91c90478be8d68392a084d23c7b7">  346</a></span>TF1* <a class="code hl_function" href="namespaceHistogramHelpers.html#a430d91c90478be8d68392a084d23c7b7">HistogramHelpers::IterativeGeneralFit</a>(TH1* hist, <span class="keywordtype">double</span>(*fcn)(<span class="keywordtype">double</span> *, <span class="keywordtype">double</span> *),<span class="keyword">const</span> std::vector&lt;float&gt;&amp; initial, <span class="keyword">const</span> std::vector&lt;float&gt;&amp; fitRange, TFitResultPtr *fitr_p, <span class="keywordtype">int</span> m_PrintLevel) {</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>  </div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> iteration_limit = 20;</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>  <span class="keyword">const</span> <span class="keywordtype">float</span> percent_limit = 0.01;</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> fDebug = 0;</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span> </div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>  <span class="keywordtype">int</span> minEntries = 50;</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>  </div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>  <span class="keywordflow">if</span> (!hist) {</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>    <span class="keywordflow">if</span> (fDebug) std::cout&lt;&lt;<span class="stringliteral">&quot;IterativeGeneralFit:: Histogram to be fit is missing. Return nullptr&quot;</span>&lt;&lt;std::endl;</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>  }</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span> </div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>  <span class="keywordflow">if</span> (hist-&gt;GetEntries() &lt; minEntries) {</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>    <span class="keywordflow">if</span> (fDebug) std::cout&lt;&lt;<span class="stringliteral">&quot;IterativeGeneralFit::Histogram to be fit is too low-stat. Return nullptr&quot;</span>&lt;&lt;std::endl;</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>  }</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span> </div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>  <span class="keywordflow">if</span> (fitRange.size() &lt; 2) {</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>    <span class="keywordflow">if</span> (fDebug) std::cout&lt;&lt;<span class="stringliteral">&quot;IterativeGeneralFit::Provide the fit range. Return nullptr&quot;</span>&lt;&lt;std::endl;</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>  }</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>    </div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>  <span class="keywordflow">if</span> (initial.size() &lt; 1) {</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>    <span class="keywordflow">if</span> (fDebug) std::cout&lt;&lt;<span class="stringliteral">&quot;IterativeGeneralFit. At least a free parameter is necessary. Return nullptr&quot;</span>&lt;&lt;std::endl;</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>  }</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>  </div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>  </div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>  <a class="code hl_function" href="namespaceHistogramHelpers.html#af6609464e2abc5928f4d6b9df5776255">HistogramConditioning</a>(hist);</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>  </div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>  TF1* fit_func = <span class="keyword">new</span> TF1(<span class="stringliteral">&quot;fit_func&quot;</span>,fcn,fitRange[0],fitRange[1],initial.size());</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>  <span class="comment">//Setting the initial parameters</span></div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;initial.size();++i) { </div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>    fit_func-&gt;SetParameter(i,initial[i]);</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>  }</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>  <span class="keywordflow">return</span> fit_func;</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>}</div>
</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span> </div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span> </div>
<div class="foldopen" id="foldopen00386" data-start="{" data-end="}">
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno"><a class="line" href="namespaceHistogramHelpers.html#a48b5e0e009cea204405075d35452b4a9">  386</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="namespaceHistogramHelpers.html#a48b5e0e009cea204405075d35452b4a9">HistogramHelpers::IterativeGaussFit</a>(TH1* hist, <span class="keywordtype">double</span> &amp;mu, <span class="keywordtype">double</span> &amp;mu_err, <span class="keywordtype">double</span> &amp;sigma, <span class="keywordtype">double</span> &amp;sigma_err, <span class="keywordtype">int</span> m_PrintLevel)</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>{</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>  </div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>  <span class="comment">//constants for fitting algorithm</span></div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> iteration_limit = 20;</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>  <span class="keyword">const</span> <span class="keywordtype">float</span> percent_limit = 0.01;</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>  <span class="keyword">const</span> <span class="keywordtype">float</span> fit_range_multiplier = 1.5;</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> fDebug = 0;</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>  </div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>  <span class="keywordtype">double</span> last_mu;</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>  <span class="keywordtype">double</span> last_sigma;</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>  <span class="keywordtype">double</span> current_mu = 0;</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>  <span class="keywordtype">double</span> current_sigma = 0;</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>  <span class="keywordtype">double</span> mu_percent_diff;</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>  <span class="keywordtype">double</span> sigma_percent_diff;</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>  </div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>  <span class="keywordtype">int</span> minEntries = 25;</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>  </div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>  <span class="keywordflow">if</span> (!hist) {</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>    <span class="keywordflow">if</span> (fDebug) std::cout&lt;&lt; <span class="stringliteral">&quot;Error in  Anp::IterativeGaussFit(): Histogram to be fit is missing&quot;</span> &lt;&lt;std::endl;</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>  }</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>  <span class="keywordflow">if</span> (hist-&gt;GetEntries() &lt; minEntries) {</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>    <span class="keywordflow">if</span> (fDebug) std::cout&lt;&lt; <span class="stringliteral">&quot;Error in  Anp::IterativeGaussFit(): Histogram has too few entries &quot;</span> &lt;&lt; hist-&gt;GetEntries() &lt;&lt; std::endl;</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>  }</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>  </div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>  <a class="code hl_function" href="namespaceHistogramHelpers.html#af6609464e2abc5928f4d6b9df5776255">HistogramConditioning</a>(hist);</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>  </div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>  TF1* fit_func = <span class="keyword">new</span> TF1(<span class="stringliteral">&quot;fit_func&quot;</span>,<span class="stringliteral">&quot;gaus&quot;</span>);</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>  </div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>  <span class="keywordtype">int</span> bad_fit = hist-&gt;Fit(fit_func,<span class="stringliteral">&quot;QN&quot;</span>);</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span> </div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>  <span class="keywordflow">if</span> (fDebug &amp;&amp; bad_fit) std::cout &lt;&lt;<span class="stringliteral">&quot;BAD INITIAL FIT: &quot;</span>&lt;&lt; hist-&gt;GetTitle() &lt;&lt; std::endl;</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>  </div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>  last_mu = fit_func-&gt;GetParameter(1);</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>  last_sigma = fit_func-&gt;GetParameter(2);</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>  </div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>  <span class="keywordflow">if</span> (bad_fit) last_mu = hist-&gt;GetMean();</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>  </div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>  <span class="comment">// check as well that the value of last_mu is reasonable</span></div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>  <span class="keywordflow">if</span> (fabs(last_mu - hist-&gt;GetMean()) &gt; 3*hist-&gt;GetBinWidth(1)) {</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>    last_mu =  hist-&gt;GetMean();</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>    last_sigma = hist-&gt;GetRMS();</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>  }</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>  </div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>  <span class="comment">// intial fit range</span></div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>  <span class="comment">// fit_func-&gt;SetRange(last_mu-fit_range_multiplier*last_sigma,last_mu+fit_range_multiplier*last_sigma);</span></div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>  <span class="comment">// superseeded below</span></div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>  </div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>  <span class="keywordtype">int</span> iteration = 0;</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>  <span class="keywordflow">while</span> ( iteration &lt; iteration_limit ) {</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>    </div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>    iteration++;</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>    </div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>    <span class="keywordtype">double</span> FitRangeLower = last_mu-fit_range_multiplier*last_sigma;</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>    <span class="keywordtype">double</span> FitRangeUpper = last_mu+fit_range_multiplier*last_sigma;</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>    </div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>    <span class="comment">// if range is to narrow --&gt; broaden it</span></div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>    <span class="keywordflow">if</span> ((FitRangeUpper-FitRangeLower)/hist-&gt;GetBinWidth(1) &lt; 5) {</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>      FitRangeLower -= hist-&gt;GetBinWidth(1);</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>      FitRangeUpper += hist-&gt;GetBinWidth(1);</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>    }</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>    </div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>    fit_func-&gt;SetRange(FitRangeLower, FitRangeUpper);</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>    <span class="keywordflow">if</span> (m_PrintLevel &gt;= 3) cout &lt;&lt; <span class="stringliteral">&quot; ** IterativeGaussFit ** fit iter # &quot;</span> &lt;&lt; iteration</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>                &lt;&lt; <span class="stringliteral">&quot;   new fit range: &quot;</span> &lt;&lt; FitRangeLower &lt;&lt; <span class="stringliteral">&quot; --&gt; &quot;</span> &lt;&lt; FitRangeUpper &lt;&lt; endl;</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>    </div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>    bad_fit = hist-&gt;Fit(fit_func, <span class="stringliteral">&quot;RQN&quot;</span>);</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>    <span class="comment">// check that fit result is sound</span></div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>    <span class="comment">// 1) the mean must be within the histogram range</span></div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>    <span class="keywordflow">if</span> (fit_func-&gt;GetParameter(1) &lt; hist-&gt;GetXaxis()-&gt;GetXmin() || fit_func-&gt;GetParameter(1) &gt; hist-&gt;GetXaxis()-&gt;GetXmax()) bad_fit = 1;</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>    <span class="comment">// 2) the sigma can not be broader than the histogram range</span></div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>    <span class="keywordflow">if</span> (fit_func-&gt;GetParameter(2) &gt; hist-&gt;GetXaxis()-&gt;GetXmax()-hist-&gt;GetXaxis()-&gt;GetXmin()) bad_fit = 1;</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>    </div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>    <span class="keywordflow">if</span> (fDebug &amp;&amp; bad_fit) std::cout&lt;&lt;<span class="stringliteral">&quot; ** BAD FIT ** : bin &quot;</span>&lt;&lt; hist-&gt;GetTitle() &lt;&lt;<span class="stringliteral">&quot;  iteration &quot;</span>&lt;&lt;iteration&lt;&lt;std::endl;</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>    </div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>    <span class="keywordflow">if</span> (bad_fit) { <span class="comment">// in case the fit looks odd, then rebin the histogram and refit with smallest divisor.</span></div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>      <span class="keywordtype">int</span> rebinFactor = 1;</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_div = 2; i_div &lt; (hist-&gt;GetXaxis()-&gt;GetNbins()/2)+1; ++i_div)</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>    <span class="keywordflow">if</span> ((hist-&gt;GetXaxis()-&gt;GetNbins() % i_div) == 0) {</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>      rebinFactor = i_div;</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>    }</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>      <span class="comment">//std::cout&lt;&lt;&quot;Rebinning by factor:&quot;&lt;&lt;rebinFactor&lt;&lt;std::endl;</span></div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>      hist-&gt;Rebin(rebinFactor);</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>      hist-&gt;Fit(fit_func, <span class="stringliteral">&quot;RQN&quot;</span>);</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>    }</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>    </div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>    <span class="comment">// extract the correction for this iteration</span></div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>    current_mu = fit_func-&gt;GetParameter(1);</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>    current_sigma = fit_func-&gt;GetParameter(2);</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>      </div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>    <span class="keywordtype">float</span> average_mu = (last_mu+current_mu)/2;</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>    <span class="keywordtype">float</span> average_sigma = (last_sigma+current_sigma)/2;</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>    </div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>    <span class="keywordflow">if</span> (average_mu == 0) {</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>      <span class="keywordflow">if</span> ( fDebug ) std::cout&lt;&lt;<span class="stringliteral">&quot; Average mu = 0 in bin &quot;</span>&lt;&lt; hist-&gt;GetTitle() &lt;&lt;std::endl;</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>      average_mu = current_mu;</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>    }</div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>    </div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>    <span class="keywordflow">if</span> (average_sigma == 0) {</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>      <span class="keywordflow">if</span> ( fDebug ) std::cout&lt;&lt;<span class="stringliteral">&quot;Average sigma = 0; Fit Problem in &quot;</span>&lt;&lt; hist-&gt;GetTitle() &lt;&lt;<span class="stringliteral">&quot;. &quot;</span>&lt;&lt;last_sigma&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;current_sigma&lt;&lt;std::endl;</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>      average_sigma = current_sigma;</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>    }</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>    </div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>    mu_percent_diff = fabs((last_mu-current_mu)/average_mu);</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>    sigma_percent_diff = fabs((last_sigma-current_sigma)/average_sigma);</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>    </div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>    <span class="keywordflow">if</span> ( mu_percent_diff &lt; percent_limit &amp;&amp; sigma_percent_diff &lt; percent_limit ) <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>    </div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>    <span class="keywordflow">if</span> (iteration != iteration_limit) { <span class="comment">//necessary?</span></div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>      last_mu = current_mu;</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>      last_sigma = current_sigma;</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>    }</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>    <span class="comment">// check as well that the last_mu is reasonable</span></div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>    <span class="keywordflow">if</span> (fabs(last_mu - hist-&gt;GetMean()) &gt; 5*hist-&gt;GetBinWidth(1)) {</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>      <span class="keywordflow">if</span> (m_PrintLevel &gt;= 3) cout &lt;&lt; <span class="stringliteral">&quot; ** IterativeGaussFit ** fit iter # &quot;</span> &lt;&lt; iteration</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>                  &lt;&lt; <span class="stringliteral">&quot; ** WARNING ** last_mu looks bad: &quot;</span> &lt;&lt; last_mu</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>                  &lt;&lt; <span class="stringliteral">&quot;    this iter mu: &quot;</span> &lt;&lt; fit_func-&gt;GetParameter(1)</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>                  &lt;&lt; <span class="stringliteral">&quot;    proposed mu: &quot;</span> &lt;&lt; hist-&gt;GetMean()</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>                  &lt;&lt; endl;</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>      last_mu =  hist-&gt;GetMean();</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>    }</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>  }</div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>  </div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>  <span class="keywordflow">if</span> (iteration == iteration_limit) {</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>    <span class="keywordflow">if</span> (fDebug ) std::cout&lt;&lt;<span class="stringliteral">&quot;WARNING: Fit did not converge to &lt; &quot;</span>&lt;&lt;percent_limit*100&lt;&lt;<span class="stringliteral">&quot;% in &quot;</span>&lt;&lt; hist-&gt;GetTitle() &lt;&lt;<span class="stringliteral">&quot; in &quot;</span>&lt;&lt;iteration_limit&lt;&lt;<span class="stringliteral">&quot; iterations. Percent Diffs: &quot;</span>&lt;&lt;mu_percent_diff*100&lt;&lt;<span class="stringliteral">&quot;% (Mu),&quot;</span>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;sigma_percent_diff*100&lt;&lt;<span class="stringliteral">&quot;% (Sigma)&quot;</span>&lt;&lt;std::endl;</div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>    <span class="comment">//possibly return a value other than 0 to indicate not converged?</span></div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>  }</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>  </div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>  mu = current_mu;</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>  mu_err = fit_func-&gt;GetParError(1);</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>  sigma = current_sigma;</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>  sigma_err = fit_func-&gt;GetParError(2);</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>  </div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>  hist-&gt;GetListOfFunctions()-&gt;Add(fit_func);</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>  </div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>  <span class="keywordflow">if</span> (m_PrintLevel &gt;= 1 ) {</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>    cout &lt;&lt; <span class="stringliteral">&quot; ** IterativeGaussFit ** fit result: histo name &quot;</span> &lt;&lt; hist-&gt;GetName() &lt;&lt; <span class="stringliteral">&quot;    title: &quot;</span> &lt;&lt; hist-&gt;GetTitle()  &lt;&lt; endl</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>     &lt;&lt; <span class="stringliteral">&quot;    mu = &quot;</span> &lt;&lt; mu &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; mu_err &lt;&lt; endl</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>     &lt;&lt; <span class="stringliteral">&quot; sigma = &quot;</span> &lt;&lt; sigma &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; sigma_err</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>     &lt;&lt; endl;</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>    <span class="comment">//if (TempCanvasIterGaussFit == NULL) {</span></div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>    <span class="comment">//TempCanvasIterGaussFit = new TCanvas (&quot;TempCanvasIterGaussFit&quot;,&quot;Iter Gauss fit&quot;, 400, 400);</span></div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>    <span class="comment">//}</span></div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>    <span class="comment">//hist-&gt;DrawCopy();</span></div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>    <span class="comment">//TempCanvasIterGaussFit-&gt;Update();</span></div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>    <span class="comment">//hist-&gt;Print();</span></div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>    <span class="keywordtype">string</span> input = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>    cout &lt;&lt; <span class="stringliteral">&quot; ** IterativeGaussFit ** Please type RETURN to continue:\n&gt;&quot;</span>;</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>    getline(cin, input);</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>  }</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>  </div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>  </div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespaceHistogramHelpers.html#acee5b9b0dba9b035cf83048ed5f529d8">outFile_for_projections</a>-&gt;IsOpen()) {</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>      TCanvas q; </div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>      q.cd();</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>      hist-&gt;Draw();</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>      fit_func-&gt;Draw(<span class="stringliteral">&quot;same&quot;</span>);</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>      std::string str = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>      <span class="comment">//q.SaveAs((str+&quot;_&quot;+hist-&gt;GetName()+&quot;.pdf&quot;).c_str());</span></div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>      <a class="code hl_variable" href="namespaceHistogramHelpers.html#acee5b9b0dba9b035cf83048ed5f529d8">outFile_for_projections</a>-&gt;cd();</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>      q.Write((str+<span class="stringliteral">&quot;_&quot;</span>+hist-&gt;GetName()).c_str()); </div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>  }</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>      </div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>}</div>
</div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span> </div>
<div class="foldopen" id="foldopen00555" data-start="{" data-end="}">
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno"><a class="line" href="namespaceHistogramHelpers.html#a82c3844fa76823b8b75dfc693a834e55">  555</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="namespaceHistogramHelpers.html#a82c3844fa76823b8b75dfc693a834e55">HistogramHelpers::OpenProjectionFile</a>() {</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>    <a class="code hl_variable" href="namespaceHistogramHelpers.html#acee5b9b0dba9b035cf83048ed5f529d8">outFile_for_projections</a> = <span class="keyword">new</span> TFile(<span class="stringliteral">&quot;debug_projections_histogramHelpers.root&quot;</span>,<span class="stringliteral">&quot;RECREATE&quot;</span>);</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>}</div>
</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span> </div>
<div class="foldopen" id="foldopen00559" data-start="{" data-end="}">
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno"><a class="line" href="namespaceHistogramHelpers.html#ad17ad0f3981ce127173a5db846c3981d">  559</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="namespaceHistogramHelpers.html#ad17ad0f3981ce127173a5db846c3981d">HistogramHelpers::CloseProjectionFile</a>() {</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>    </div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespaceHistogramHelpers.html#acee5b9b0dba9b035cf83048ed5f529d8">outFile_for_projections</a>-&gt;IsOpen())  </div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>        <a class="code hl_variable" href="namespaceHistogramHelpers.html#acee5b9b0dba9b035cf83048ed5f529d8">outFile_for_projections</a>-&gt;Close();</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>}</div>
</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span> </div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span> </div>
<div class="foldopen" id="foldopen00566" data-start="{" data-end="}">
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno"><a class="line" href="namespaceHistogramHelpers.html#af6609464e2abc5928f4d6b9df5776255">  566</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="namespaceHistogramHelpers.html#af6609464e2abc5928f4d6b9df5776255">HistogramHelpers::HistogramConditioning</a> (TH1* hist,<span class="keywordtype">int</span> m_PrintLevel)</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>{</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>  <span class="keywordflow">if</span> (m_PrintLevel&gt;=3) cout &lt;&lt; <span class="stringliteral">&quot; ** HistogramConditioning ** START ** hist = &quot;</span> &lt;&lt; hist-&gt;GetName() &lt;&lt; endl;</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span> </div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>  <span class="keywordtype">double</span> MinEntriesMPB = 15;</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>  Int_t NGroupBins = 2;</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span> </div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>  <span class="comment">// goal:</span></div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>  <span class="comment">// make sure that the most populated bin has a minimum number of entries</span></div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>  Int_t  MostPopulatedBin = (hist-&gt;GetMaximumBin());</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>  <span class="keywordtype">double</span> EntriesMPB = hist-&gt;GetBinContent(MostPopulatedBin);</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>  <span class="keywordflow">if</span> (EntriesMPB &lt; MinEntriesMPB) {</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>    <span class="comment">// check the entries of the neighbour channels</span></div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>    <span class="keywordflow">if</span> ((EntriesMPB + hist-&gt;GetBinContent(MostPopulatedBin+1) + hist-&gt;GetBinContent(MostPopulatedBin-1)) &gt; MinEntriesMPB) {</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>      NGroupBins = 2;</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>    }</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>    <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>      NGroupBins = 3;</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>    }</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span> </div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>    <span class="comment">// now find the first divisor (factor of ) the original number of bins</span></div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>    Bool_t DivisorFound = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>    <span class="keywordflow">while</span> (!DivisorFound) {</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>      <span class="keywordflow">if</span> ( hist-&gt;GetNbinsX() % NGroupBins == 0) {</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>    DivisorFound = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>      }</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>      <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>    DivisorFound = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>    NGroupBins++;</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>      }</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>    }</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>    Int_t NBinsWas = hist-&gt;GetNbinsX();</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>    hist = hist-&gt;Rebin(NGroupBins);</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>    <span class="keywordflow">if</span> (m_PrintLevel&gt;=1) cout &lt;&lt; <span class="stringliteral">&quot; ** HistogramConditioning ** histogram had to be rebinned by: &quot;</span> &lt;&lt; NGroupBins</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>                  &lt;&lt; <span class="stringliteral">&quot; NBins was: &quot;</span> &lt;&lt; NBinsWas &lt;&lt; <span class="stringliteral">&quot; and now is: &quot;</span> &lt;&lt; hist-&gt;GetNbinsX() &lt;&lt; endl;</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span> </div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>  }</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span> </div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span> </div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>  <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>}</div>
</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span> </div>
<div class="ttc" id="aHistogramHelpers_8h_html"><div class="ttname"><a href="HistogramHelpers_8h.html">HistogramHelpers.h</a></div></div>
<div class="ttc" id="anamespaceHistogramHelpers_html_a0bc0b4eb1d4612a7d4cc9f681eb86deb"><div class="ttname"><a href="namespaceHistogramHelpers.html#a0bc0b4eb1d4612a7d4cc9f681eb86deb">HistogramHelpers::profileYwithIterativeGaussFit</a></div><div class="ttdeci">void profileYwithIterativeGaussFit(TH2 *hist, TH1 *mu_graph, TH1 *sigma_graph, int num_bins=1, int m_PrintLevel=0)</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition</b> <a href="HistogramHelpers_8cxx_source.html#l00225">HistogramHelpers.cxx:225</a></div></div>
<div class="ttc" id="anamespaceHistogramHelpers_html_a430d91c90478be8d68392a084d23c7b7"><div class="ttname"><a href="namespaceHistogramHelpers.html#a430d91c90478be8d68392a084d23c7b7">HistogramHelpers::IterativeGeneralFit</a></div><div class="ttdeci">TF1 * IterativeGeneralFit(TH1 *hist, double(*fcn)(double *, double *), const std::vector&lt; float &gt; &amp;initial, const std::vector&lt; float &gt; &amp;fitRange, TFitResultPtr *fitr_p, int m_PrintLevel)</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition</b> <a href="HistogramHelpers_8cxx_source.html#l00346">HistogramHelpers.cxx:346</a></div></div>
<div class="ttc" id="anamespaceHistogramHelpers_html_a48b5e0e009cea204405075d35452b4a9"><div class="ttname"><a href="namespaceHistogramHelpers.html#a48b5e0e009cea204405075d35452b4a9">HistogramHelpers::IterativeGaussFit</a></div><div class="ttdeci">int IterativeGaussFit(TH1 *hist, double &amp;mu, double &amp;mu_err, double &amp;sigma, double &amp;sigma_err, int m_PrintLevel=0)</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition</b> <a href="HistogramHelpers_8cxx_source.html#l00386">HistogramHelpers.cxx:386</a></div></div>
<div class="ttc" id="anamespaceHistogramHelpers_html_a5a70ca52b4c9a41f1bd3a7c4446edb9f"><div class="ttname"><a href="namespaceHistogramHelpers.html#a5a70ca52b4c9a41f1bd3a7c4446edb9f">HistogramHelpers::twoGauss_f</a></div><div class="ttdeci">double twoGauss_f(double *x, double *par)</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition</b> <a href="HistogramHelpers_8cxx_source.html#l00063">HistogramHelpers.cxx:63</a></div></div>
<div class="ttc" id="anamespaceHistogramHelpers_html_a79cb627357d524afbace2610d218ff94"><div class="ttname"><a href="namespaceHistogramHelpers.html#a79cb627357d524afbace2610d218ff94">HistogramHelpers::twoGaussExp_f</a></div><div class="ttdeci">double twoGaussExp_f(double *x, double *par)</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition</b> <a href="HistogramHelpers_8cxx_source.html#l00042">HistogramHelpers.cxx:42</a></div></div>
<div class="ttc" id="anamespaceHistogramHelpers_html_a82c3844fa76823b8b75dfc693a834e55"><div class="ttname"><a href="namespaceHistogramHelpers.html#a82c3844fa76823b8b75dfc693a834e55">HistogramHelpers::OpenProjectionFile</a></div><div class="ttdeci">void OpenProjectionFile()</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition</b> <a href="HistogramHelpers_8cxx_source.html#l00555">HistogramHelpers.cxx:555</a></div></div>
<div class="ttc" id="anamespaceHistogramHelpers_html_acee5b9b0dba9b035cf83048ed5f529d8"><div class="ttname"><a href="namespaceHistogramHelpers.html#acee5b9b0dba9b035cf83048ed5f529d8">HistogramHelpers::outFile_for_projections</a></div><div class="ttdeci">TFile * outFile_for_projections</div><div class="ttdef"><b>Definition</b> <a href="HistogramHelpers_8h_source.html#l00121">HistogramHelpers.h:121</a></div></div>
<div class="ttc" id="anamespaceHistogramHelpers_html_ad17ad0f3981ce127173a5db846c3981d"><div class="ttname"><a href="namespaceHistogramHelpers.html#ad17ad0f3981ce127173a5db846c3981d">HistogramHelpers::CloseProjectionFile</a></div><div class="ttdeci">void CloseProjectionFile()</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition</b> <a href="HistogramHelpers_8cxx_source.html#l00559">HistogramHelpers.cxx:559</a></div></div>
<div class="ttc" id="anamespaceHistogramHelpers_html_ae255e3c553d1f6fc52871f614713b342"><div class="ttname"><a href="namespaceHistogramHelpers.html#ae255e3c553d1f6fc52871f614713b342">HistogramHelpers::profileZwithIterativeGaussFit</a></div><div class="ttdeci">void profileZwithIterativeGaussFit(TH3 *hist, TH2 *mu_graph, TH2 *sigma_graph, int num_bins, TH2 *mu_err_graph, TH2 *sigma_err_graph)</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition</b> <a href="HistogramHelpers_8cxx_source.html#l00078">HistogramHelpers.cxx:78</a></div></div>
<div class="ttc" id="anamespaceHistogramHelpers_html_af5e7ea391529a3ec63decc5523bcd34a"><div class="ttname"><a href="namespaceHistogramHelpers.html#af5e7ea391529a3ec63decc5523bcd34a">HistogramHelpers::GaussExpTails_f</a></div><div class="ttdeci">double GaussExpTails_f(double *x, double *par)</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition</b> <a href="HistogramHelpers_8cxx_source.html#l00006">HistogramHelpers.cxx:6</a></div></div>
<div class="ttc" id="anamespaceHistogramHelpers_html_af6609464e2abc5928f4d6b9df5776255"><div class="ttname"><a href="namespaceHistogramHelpers.html#af6609464e2abc5928f4d6b9df5776255">HistogramHelpers::HistogramConditioning</a></div><div class="ttdeci">void HistogramConditioning(TH1 *hist, int m_PrintLevel=0)</div><div class="ttdoc">description</div><div class="ttdef"><b>Definition</b> <a href="HistogramHelpers_8cxx_source.html#l00566">HistogramHelpers.cxx:566</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
